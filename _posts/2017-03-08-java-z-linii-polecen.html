---
layout: post
title: Java z linii poleceń
excerpt: "W tym artykule przeczytasz o narzędziach dostarczonych wraz z JDK. Dowiesz
  się jak używać kompilatora <code>javac</code>. Stworzysz swój pierwszy
  plik JAR. Po przeczytaniu tego artykułu zrozumiesz działanie podstawowych narzędzi
  dołączonych do JDK i docenisz kawał pracy jaką odwala za nas IDE :). Dowiesz się
  czym jest classpath i dlaczego ścieżka ta jest niezmiernie ważna. Zapraszam do lektury.\r\n\r\n"
date: '2017-03-08 20:35:45 +0100'
categories:
- Kurs programowania Java
- DSP2017
---
<p>W tym artykule przeczytasz o narzędziach dostarczonych wraz z JDK. Dowiesz się jak używać kompilatora <code>javac</code>. Stworzysz swój pierwszy plik JAR. Po przeczytaniu tego artykułu zrozumiesz działanie podstawowych narzędzi dołączonych do JDK i docenisz kawał pracy jaką odwala za nas IDE :). Dowiesz się czym jest classpath i dlaczego ścieżka ta jest niezmiernie ważna. Zapraszam do lektury.</p>
<p><a id="more"></a><a id="more-770"></a></p>
<h1>Java z poziomu linii poleceń</h1><br />
Dzisiaj na przekór moim wszystkim radom, proszę Cie nie korzystaj z IDE. Wyłącz InteliJ Idea czy Eclipsa. Przejdź przez cały artykuł używając wyłącznie podstawowego edytora tekstu. Moim celem jest przeprowadzenie Cię przez cały proces pisania kodu w Javie używając podstawowych narzędzi.</p>
<p>Moim zdaniem takie podejście pozwoli Ci zrozumieć te podstawy, na których opiera się cała reszta. Osobiście dużo łatwiej jest mi pojąć bardziej skomplikowane rzeczy jeśli dokładnie wiem jak działają podstawowe klocki, których używa się do budowania tych bardziej skomplikowanych elementów.</p>
<p>Dzisiaj używał będę programu <a href="https://wiki.gnome.org/Apps/Gedit" target="_blank">gedit</a>, pracując w systemie Windows możesz użyć standardowego systemowego notatnika. Istotne jest to, aby program ten był w stanie utworzyć zwykły plik tekstowy, któremu nadasz rozszerzenie java.</p>
<h1>Narzędzia dostępne w JDK</h1><br />
O tym czym jest JDK i czym różni się od JRE pisałem w jednym z pierwszych artykułów na blogu - o <a href="http://www.samouczekprogramisty.pl/przygotowanie-srodowiska-programisty/">przygotowaniu środowiska programisty</a>. Dowiesz się też tam jak zainstalować JDK. Dzisiaj będą dla Ciebie istotne trzy programy. <code>java</code> dostarczana jest wraz z JRE, <code>javac</code> i <code>jar</code> dostępne są wyłącznie w JDK:</p>
<ul>
<li><code>java</code> uruchamia maszynę wirtualną, wywołując metodę <code>main</code> w odpowiedniej klasie,</li>
<li><code>javac</code> to kompilator, który jest w stanie utworzyć plik class z pliku java,</li>
<li><code>jar</code> to narzędzie, które jest w stanie tworzyć pliki jar.</li><br />
</ul></p>
<h1>Pierwsza klasa w notatniku</h1><br />
Zacznijmy od początku, od programu wyświetlającego Twoje imię na konsoli. Będzie to zwykła klasa o nazwie <code>DisplayName</code> w pakiecie domyślnym, która będzie miała metodę <code>public static void main(String ... args)</code>. Wewnątrz tej metody wpisz instrukcję, która wypisze Twoje imię. Spróbuj napisać ten program bez IDE i zapisz go w pliku z rozszerzeniem java.</p>
<p>Dla mnie takie ćwiczenia na początku były dość trudne, pokazywały jak ważne i pomocne jest IDE w codziennej pracy. Mam nadzieję, że Tobie też pomoże to uświadomić.</p>
<p>Po tym wszystkim powinieneś mieć plik <code>DisplayName.java</code>, który będzie wyglądał podobnie do przykładu poniżej:</p>
<pre class="lang:default decode:true ">public class DisplayName {<br />
    public static void main(String ... args) {<br />
        System.out.println(&ldquo;Marcin&rdquo;);<br />
    }<br />
}</pre></p>
<h1><code>javac</code> - skompiluj swoją klasę</h1><br />
I teraz dochodzimy do sedna sprawy, jak uruchomić taki program? Otóż trzeba go na początku skompilować. Do tego celu służy jedno z podstawowych i najczęściej używanych narzędzi dostarczonych wraz z JDK - kompilator języka Java. Jest to program <code>javac</code>. Wpisując w konsoli polecenie <code>javac -help</code> pokaże Ci się taka lista opcji (tutaj pokazałem wyłącznie kilka pierwszych linijek):</p>
<pre class="lang:default highlight:0 decode:true">$ javac -help<br />
Usage: javac<br />
<options> <source files><br />
where possible options include:<br />
  -g                         Generate all debugging info<br />
  -g:none                    Generate no debugging info<br />
  -g:{lines,vars,source}     Generate only some debugging info<br />
  -nowarn                    Generate no warnings<br />
  -verbose                   Output messages about what the compiler is doing<br />
  -deprecation               Output source locations where deprecated APIs are used<br />
  -classpath
<path>          Specify where to find user class files and annotation processors<br />
  -cp
<path>                 Specify where to find user class files and annotation processors<br />
...</pre><br />
Więc skompilujmy tę pierwszą klasę :). Aby to zrobić należy uruchomić komendę <code>javac DisplayName.java</code>. Po jej uruchomieniu kompilator powinien utworzyć plik binarny z rozszerzeniem class - <code>DisplayName.class</code>. Plik ten zawiera instrukcje, które są zrozumiałe dla wirtualnej maszyny Javy.</p>
<p>A oto jak wygląda katalog, w którym aktualnie znajduje się kod źródłowy razem ze skompilowaną klasą:</p>
<pre class="lang:default highlight:0 decode:true">$ tree .<br />
.<br />
├── DisplayName.class<br />
└── DisplayName.java</p>
<p>0 directories, 2 files</pre></p>
<h1><code>java</code> - uruchom swoją klasę</h1><br />
Skoro mamy już kod, mamy też skompilowaną klasę przydałoby się ją jakoś uruchomić :). Z pomocą przychodzi kolejny bardzo ważny program - <code>java</code>. Program ten uruchamia wirtualną maszynę Javy. Wpisując w konsoli <code>java -help</code> ponownie pokażą się dostępne opcje (skróciłem je także tutaj):</p>
<pre class="lang:default highlight:0 decode:true ">$ java -help<br />
Usage: java [-options] class [args...]<br />
           (to execute a class)<br />
   or  java [-options] -jar jarfile [args...]<br />
           (to execute a jar file)<br />
where options include:<br />
    ...<br />
    -server      to select the "server" VM<br />
                  The default VM is server,<br />
                  because you are running on a server-class machine.<br />
    -cp <class search path of directories and zip/jar files><br />
    -classpath <class search path of directories and zip/jar files><br />
                  A : separated list of directories, JAR archives,<br />
                  and ZIP archives to search for class files.<br />
    ...</pre><br />
Teraz masz już wszystkie potrzebne składniki do uruchomienia programu. Możesz to zrobić wpisując <code>java DisplayName</code>:</p>
<pre class="lang:default highlight:0 decode:true ">$ java DisplayName<br />
Marcin</pre></p>
<h1>Pracowity skrzat IDE</h1><br />
Niby prosty program, a do jego uruchomienia trzeba użyć 2 magicznych programów, jak tak można? ;). Okazuje się, że właśnie podobne czynności robi za nas IDE. Za każdym razem[1. Jak zwykle są wyjątki, ale nie są one istotne w tym przypadku] gdy w InteliJ użyjesz klawiszy <code>Ctr+Schift+F10</code> (uruchom program) InteliJ Idea robi podobne rzeczy. Kompiluje kod używając do tego programu <code>javac</code> a następnie uruchamia w odpowiedni sposób JRE używając programu <code>java</code>.</p>
<h1>Pakiety</h1><br />
A teraz zrób krok do przodu - utwórz tę samą klasę w pakiecie <code>pl.samouczekprogramisty.commandline</code> i skompiluj ją przy pomocy <code>javac</code>. Przykład poniżej pokazuje poprawna strukturę katalogów dla klasy w takim pakiecie</p>
<pre class="lang:default highlight:0 decode:true">$ tree .<br />
.<br />
└── pl<br />
    └── samouczekprogramisty<br />
        └── commandline<br />
            └── DisplayName.java</p>
<p>3 directories, 2 files</pre><br />
Aby to zrobić musisz utworzyć plik ze źródłem w odpowiednim folderze, oczywiście wtedy deklaracja <code>package</code> na początku pliku powinna odzwierciedlać tę ścieżkę. W moim przypadku plik wygląda następująco:</p>
<pre class="lang:default decode:true ">package pl.samouczekprogramisty.commandline;</p>
<p>public class DisplayName {<br />
    public static void main(String ... args) {<br />
        System.out.println("Marcin pakiet");<br />
    }<br />
}</pre><br />
Następinie używając programów <code>javac</code> i <code>java</code> mogę skompilować i uruchomić odpowiednią klasę używając poleceń:</p>
<pre class="lang:default highlight:0 decode:true ">javac pl/samouczekprogramisty/commandline/DisplayName.java<br />
java pl.samouczekprogramisty.commandline.DisplayName</pre><br />
Jak widzisz <code>javac</code> przyjmuje jako parametr ścieżkę do pliku, który chcesz skompilować. Program <code>java</code> natomiast przyjmuje pełną nazwę klasy (wraz z pakietem) wewnątrz której znajduje się metoda <code>main</code>. Dochodzimy tutaj do pewnej istotnej rzeczy, gdzie program <code>java</code> ma &ldquo;szukać&rdquo; tej klasy? Odpowiedzią na to pytanie jest <code>classpath</code>. Po polsku będę to nazywał ścieżką przeszukiwania.</p>
<p>W przypadku systemów z rodziny Windows katalogi w ścieżce do klasy, którą kompilujesz oddzielone są znakiem <code>\</code> a nie <code>/</code> jak w przykładzie.</p>
<h1>Czym jest classpath</h1><br />
No właśnie, czym jest classpath, magiczna ścieżka przeszukiwania? Wyjaśniając to pojęcie w jednym zdaniu - classpath to ścieżka, gdzie program <code>java</code> szuka klas, które potrzebne są w trakcie uruchomienia programu.</p>
<p>Możesz zatem zapytać &ldquo;dlaczego poprzednio <code>java DisplayName</code> działało?" Działało, ponieważ jeśli nie ustawisz żadnej wartości, ścieżka przeszukiwania przyjmuje wartość domyślną - <code>.</code>. Ta kropka oznacza katalog, w którym aktualnie się znajdujesz.</p>
<p>Jako ćwiczenie możesz spróbować przejść do innego katalogu i uruchomić to samo polecenie, przykład poniżej pokazuje zachowanie jakie możesz uzyskać:</p>
<pre class="lang:default highlight:0 decode:true ">~$ tree .<br />
.<br />
└── pl<br />
    └── samouczekprogramisty<br />
        └── commandline<br />
            ├── DisplayName.class<br />
            └── DisplayName.java</p>
<p>3 directories, 2 files<br />
~$ java pl.samouczekprogramisty.commandline.DisplayName<br />
Marcin pakiet<br />
~$ cd pl<br />
~/pl$ java pl.samouczekprogramisty.commandline.DisplayName<br />
Error: Could not find or load main class pl.samouczekprogramisty.commandline.DisplayName<br />
</pre><br />
Jak widzisz w ostatniej linii program <code>java</code> wyświetlił błąd informujący, że nie może znaleźć klasy <code>pl.samouczekprogramisty.commandline.DisplayName</code> na aktualnej ścieżce przeszukiwania. Program szukał struktury pakietów pl/samouczekrogramisty/commandline, a w katalogu pl był jedynie katalog samouczekprogramisty, nie było katalogu pl.</p>
<p>Ścieżka przeszukiwania to lista katalogów oddzielonych odpowiednim znakiem gdzie program <code>java</code> powinien szukać klas. Na tej ścieżce poza katalogami mogą znajdować się też pliki zip czy pliki jar[3. Tak na prawdę plik jar to plik zip z innym rozszerzeniem.]. Przykład poniżej pokazuje ścieżkę przeszukiwania na której znajdują się 3 elementy:</p>
<pre class="lang:default highlight:0 decode:true ">some/path:.:other/path/file.jar</pre><br />
Pierwszy z nich to katalog some/path. Drugi z nich to katalog bieżący oznaczony znakiem <code>.</code>. Ostatni to ścieżka do pliku jar, wewnątrz którego znajdują się skompilowane klasy.</p>
<p>W przypadku sytemów z rodziny Windows do rozdzielenia elementów na ścieżce przeszukiwania używa się znaku <code>;</code>. W pozostałych znanych mi systemach jest to znak <code>:</code> jak widzisz w przykładzie powyżej.</p>
<h1>Jak ustawić classpath</h1><br />
Ścieżka przeszukiwania może być ustalona na dwa sposoby. Pierwszym z nich jest użycie argumentu linii poleceń <code>-cp</code> lub <code>-classpath</code>. Drugim jest ustawienie zmiennej środowiskowej <code>CLASSPATH</code>.</p>
<p>Jeśli nie użyjesz żadnej z tych metod, ścieżka przeszukiwania przyjmie wspomnianą już domyślną wartość.</p>
<h1>Classpath w trakcie kompilacji</h1><br />
Nie tylko program <code>java</code> używa ścieżki przeszukiwania. Jest ona także używana w trakcie kompilacji. Wyobraź sobie swoją klasę, która zależy od innych klas. Na przykład używasz biblioteki <a href="https://github.com/apache/commons-lang" target="_blank">Apache Commons Lang</a> i klasy <a href="https://github.com/apache/commons-lang/blob/master/src/main/java/org/apache/commons/lang3/StringUtils.java" target="_blank"><code>StringUtils</code></a>.</p>
<p>Załóżmy, że chcesz użyć metody <a href="https://github.com/apache/commons-lang/blob/master/src/main/java/org/apache/commons/lang3/StringUtils.java#L1929" target="_blank"><code>StringUtils.containsIgnoreCase</code></a>. Spróbuj napisać kod w notatniku, bez pomocy IDE, który pobierze od użytkownika łańcuch znaków. Następnie sprawdzi (ignorując wielkość liter), czy w tym łańcuchu znajduje się Twoje imię.</p>
<p>Zdaję sobie sprawę, że jest to trudne ćwiczenie, jednak spróbuj wykonać je samodzielnie. Do wykonania tego ćwiczenia możesz użyć klasy <code>java.util.Scanner</code> i wspomnianej klasy <code>StringUtils</code>. Nie zapomnij o odpowiednich deklaracjach <code>import</code>. Prawdopodobnie bez dostępu do IDE nie zrobisz tego zadania bezbłędnie za pierwszym razem. Nie przejmuj się, to właśnie przy poprawianiu błędów nauczysz się najwięcej.</p>
<p>Plik JAR z tą biblioteką możesz pobrać z <a href="http://central.maven.org/maven2/org/apache/commons/commons-lang3/3.5/commons-lang3-3.5.jar" target="_blank">repozytorium Mavena</a> (jeśli nie wiesz czym jest takie repozytorium odsyłam Cię do artykułu <a href="http://www.samouczekprogramisty.pl/wstep-do-gradle/">Wstęp do Gradle</a>).</p>
<p>Kod, który napisałeś mógłby wyglądać jak w przykładzie poniżej:</p>
<pre class="lang:default decode:true">package pl.samouczekprogramisty.commandline;</p>
<p>import java.util.Scanner;<br />
import org.apache.commons.lang3.StringUtils;</p>
<p>public class CheckName {<br />
    public static void main(String ... args) {<br />
        System.out.println("Podaj zdanie");<br />
        Scanner scanner = new Scanner(System.in);<br />
        String sentence = scanner.nextLine();</p>
<p>        if (StringUtils.containsIgnoreCase(sentence, "Marcin")) {<br />
            System.out.println("To zdanie zawiera moje imie!");<br />
        }<br />
        else {<br />
            System.out.println("To zdanie nie zawiera mojego imienia!");<br />
        }<br />
    }<br />
}</pre><br />
Jak widzisz, użyłem tu klasy wcześniej wspomnianej klasy <code>Scanner</code> i <code>StringUtils</code>. Pierwsza z nich znajduje się w bibliotece standardowej Javy. Jest ona domyślnie dostępna w trakcie uruchomienia i kompilacji. Jednak w przypadku klasy <code>StringUtils</code> jest inaczej.</p>
<p>Jest to klasa zewnętrza więc musi być dostarczona zarówno w trakcie kompilacji jak i uruchomienia programu. Spójrz proszę na komendy użyte do kompilacji i uruchomienia programu:</p>
<pre class="lang:default highlight:0 decode:true ">javac -cp commons-lang3-3.5.jar pl/samouczekprogramisty/commandline/CheckName.java<br />
java -cp .:commons-lang3-3.5.jar pl.samouczekprogramisty.commandline.CheckName</pre><br />
W pierwszej linii jako ścieżkę przeszukiwania ustawiamy plik jar zawierający klasę <code>StringUtils</code>. To wywołanie kompiluje klasę <code>CheckName</code>. Dzięki temu uzyskamy plik <code>CheckName.class</code>, który chcemy uruchomić.</p>
<p>Kolejna linijka to właśnie to uruchomienie. Zauważ, że w tym przypadku ścieżka przeszukiwania zawiera zarówno aktualny katalog jak i plik jar. Aktualny katalog jest niezbędny żeby znaleźć klasę <code>CheckName</code>. Plik jar natomiast jest wymagany do odnalezienia klasy <code>StringUtils</code>.</p>
<p>Teraz czas na Twoje eksperymenty. Co się stanie jeśli uruchomisz swój program bez z <code>-cp</code>? :)</p>
<h1>Pliki JAR</h1><br />
No dobrze, a co jeśli chcemy w łatwy sposób przekazać komuś skompilowany kod? Bardzo dobrze do tego celu nadają się pliki JAR. JAR czyli Java Archive to nic innego jak plik zip, wewnątrz którego znajduje się zestaw plików class ze skompilowanymi klasami[4. Oczywiście pliki jar mogą zawierać także pliki innego rodzaju, jednak na tym etapie wystarczy wiedza o class i pliku tekstowym Manifest.].</p>
<p>Klasy wewnątrz archiwum znajdują się w odpowiednich katalogach, które odzwierciedlają strukturę pakietów. Spróbujmy teraz przygotować Twój pierwszy jar z linii poleceń.</p>
<p>Program <code>jar</code> ma także inne zastosowania. Na przykład przy jego pomocy możesz wyświetlić zawartość istniejącego pliku JAR. Służy do tego komenda pokazana poniżej:</p>
<pre class="lang:default highlight:0 decode:true ">jar tf commons-lang3-3.5.jar</pre><br />
Tworzenie pliku JAR jest dość proste. Wystarczy podać odpowiedni zestaw parametrów jak w przykładzie poniżej:</p>
<pre class="lang:default highlight:0 decode:true ">jar cf <nazwa pliku wyjściowego>
<lista katalogów, klas do umieszczenia w pliku JAR></pre><br />
W przypadku przykładu używanego poprzednio cały zestaw komend wyglądałby następująco:</p>
<pre class="lang:default highlight:0 decode:true">$ tree .<br />
.<br />
└── pl<br />
    └── samouczekprogramisty<br />
        └── commandline<br />
            ├── CheckName.class<br />
            ├── CheckName.java<br />
            ├── DisplayName.class<br />
            └── DisplayName.java</p>
<p>3 directories, 4 files<br />
$ jar cf JavaCommandline.jar .<br />
$ jar tf JavaCommandline.jar<br />
META-INF/<br />
META-INF/MANIFEST.MF<br />
pl/<br />
pl/samouczekprogramisty/<br />
pl/samouczekprogramisty/commandline/<br />
pl/samouczekprogramisty/commandline/DisplayName.java<br />
pl/samouczekprogramisty/commandline/DisplayName.class<br />
pl/samouczekprogramisty/commandline/CheckName.class<br />
pl/samouczekprogramisty/commandline/CheckName.java</pre><br />
Jak widzisz, pliki znajdujące się w katalogu zostały dodane do pliku JAR. Program tutaj nie przeprowadził żadnego filtrowania - umieścił w archiwum także pliki java. Dlatego właśnie bardzo często pliki class umieszczamy w zupełnie innym katalogu niż pliki źródłowe.</p>
<p>Dodatkowo wewnątrz pliku JAR znajduje się też plik MANIFEST.MF, który zawiera metadane na temat tego archiwum. Wewnątrz tego pliku możemy skonfigurować na przykład domyślną klasę, która powinna być uruchamiana podczas wykonania polecenia</p>
<pre class="lang:default highlight:0 decode:true ">$ java -jar <ścieżka do pliku JAR></pre></p>
<h1>Dodatkowe materiały do nauki</h1><br />
Artykuł ten był wybitnie praktyczny. Zależało mi na tym abyś krok po kroku realizował poszczególne etapy. Jeśli tego nie zrobiłeś, bardzo proszę spróbuj. Jeśli chciałbyś dowiedzieć się więcej o narzędziach, które opisałem w artykule mam dla Ciebie zestaw kilku dodatkowych dokumentów:</p>
<ul>
<li><a href="http://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html" target="_blank">dokumentacja programu <code>java</code></a>,</li>
<li><a href="http://docs.oracle.com/javase/8/docs/technotes/tools/unix/javac.html" target="_blank">dokumentacja programu <code>javac</code></a>,</li>
<li><a href="http://docs.oracle.com/javase/8/docs/technotes/tools/unix/jar.html" target="_blank">dokumentacja programu <code>jar</code></a>,</li>
<li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/jar/jar.html" target="_blank">specyfikacja plików jar</a>,</li>
<li><a href="https://github.com/SamouczekProgramisty/KursJava/tree/master/25_linia_polecen/src/main/java/pl/samouczekprogramisty/commandline" target="_blank">kod źródłowy przykładów użytych w artykule</a>.</li><br />
</ul></p>
<h1>Podsumowanie</h1><br />
Mam nadzieję, że taki praktyczny przewodnik krok po krodu po podstawowych narzędziach dostepnych z JRE i JDK przypadł Ci do gustu. Daj znać w komentarzach jak Ci poszło z przerobieniem ćwiczeń z treści artykułu :).</p>
<p>Po przeczytaniu tekstu znasz podstawowe narzędzia używane przy programowaniu w języku Java. Jesteś w stanie stworzyć swój plik jar i uruchomić klasy, które skmpilujesz podstawowymi narzędziami. Dzięki temu lepiej rozumiesz "magię", którą na codzień robi IDE. Wiesz jak bardzo upraszcza ono Twoją pracę z kodem.</p>
<p>Jeśli nie chcesz pominąć kolejnych artykułów dopisz się do mojego newslettera i polub Samouczka na facebooku.</p>
<p>Na koniec mam do Ciebie standardową prośbę, podziel się linkiem do artykułu ze znajomymi, zależy mi na dotarciu do jak największej liczby samouków, którzy chcą pogłębiać swoją wiedzę. Do następnego razu!</p>
<p>[FM_form id="3"]</p>
<p>Zdjęcie dzięki uprzejmości https://www.flickr.com/photos/wwward0/9176827666/sizes/l</p>
