---
layout: post
status: publish
published: true
title: Pogodynka - działający termometr
author:
  display_name: Marcin Pietraszek
  login: marcin
  email: m.pietraszek@gmail.com
  url: ''
author_login: marcin
author_email: m.pietraszek@gmail.com
excerpt: "Relacja z frontu projektu Pogodynka. Dzisiaj przeczytasz o tym czym jest
  projekt modułowy w Gradle, zobaczysz jak wygląda podstawowy szablon aplikacji webowej.
  Dowiesz się też jak odczytywać temperaturę z czujnika DS18B20, który podłączyłem
  do Malinki. Zapraszam do lektury.\r\n\r\n"
wordpress_id: 789
wordpress_url: http://www.samouczekprogramisty.pl/?p=789
date: '2017-03-19 19:16:29 +0100'
date_gmt: '2017-03-19 18:16:29 +0100'
categories:
- DSP2017
- Projekty
- Pogodynka
tags: []
---
<p>Relacja z frontu projektu Pogodynka. Dzisiaj przeczytasz o tym czym jest projekt modułowy w Gradle, zobaczysz jak wygląda podstawowy szablon aplikacji webowej. Dowiesz się też jak odczytywać temperaturę z czujnika DS18B20, który podłączyłem do Malinki. Zapraszam do lektury.</p>
<p><a id="more"></a><a id="more-789"></a></p>
<h1>Postęp w module Thermometer</h1><br />
Mogę powiedzieć, że pierwszy moduł całej aplikacji jest &ldquo;gotowy&rdquo;. Podłączyłem czujnik temperatury do Malinki, udało mi się nawet odczytać wskazania temperatury. Klasa <code><a href="https://github.com/SamouczekProgramisty/Pogodynka/blob/master/thermometer/src/main/java/pl/samouczekprogramisty/pogodynka/thermometer/FromFileThermometer.java" target="_blank">FromFileThermometer</a></code> jest w stanie przeczytać zawartość takiego pliku i odpowiednio ją zinterpretować, udowadnia to test jednostkowy <code><a href="https://github.com/SamouczekProgramisty/Pogodynka/blob/master/thermometer/src/test/java/pl/samouczekprogramisty/pogodynka/thermometer/FromFileThermometerTest.java" target="_blank">FromFileThermometerTest</a></code>.</p>
<h2>Praca z czujnikiem DS18B20 na Malince</h2><br />
Czujnik temperatury DS18B20 można połączyć bezpośrednio pod wyjścia GPIO (ang. <em>General Purpose Input Output</em>). Wystarczy do tego sam czujnik i opornik 4.7k. W moim przypadku na zdjęciu poniżej widać to połączenie:</p>
<p><a href="http://www.samouczekprogramisty.pl/wp-content/uploads/2017/03/raspberry_pi_polaczenie.jpg"><img class="aligncenter size-medium wp-image-791" src="http://www.samouczekprogramisty.pl/wp-content/uploads/2017/03/raspberry_pi_polaczenie-225x300.jpg" alt="podpięcie czujnika temperatury" width="225" height="300" /></a></p>
<p>U siebie zastosowałem opornik 4.6k (akurat taki udało mi się dostać w sklepie).</p>
<p>Jeśli wszystko działa poprawnie Malinka wykryje czujnik i w katalogu <code>/sys/bus/w1/devices</code> znajdzie się katalog o nazwie <code>28-00000xxxxxx</code>. <code>xxxxxx</code> może być różne i jest unikalnym identyfikatorem danego czujnika. Wewnątrz tego katalogu znajduje się plik <code>w1_slave</code>, który zawiera aktualne wskazanie czujnika.</p>
<p><a href="http://www.samouczekprogramisty.pl/wp-content/uploads/2017/03/raspberry_pi_temperature.png"><img class="aligncenter size-medium wp-image-792" src="http://www.samouczekprogramisty.pl/wp-content/uploads/2017/03/raspberry_pi_temperature-300x180.png" alt="wskazanie czujnika temperatury" width="300" height="180" /></a></p>
<p>Odczytanie temperatury sprowadza się do poprawnego parsowania zawartości tego pliku. Przykład realizacji możesz znaleźć we wcześniej wspomnianej klasie <code><a href="https://github.com/SamouczekProgramisty/Pogodynka/blob/master/thermometer/src/main/java/pl/samouczekprogramisty/pogodynka/thermometer/FromFileThermometer.java" target="_blank">FromFileThermometer</a></code>.</p>
<h1>Zmiany w Gradle</h1><br />
Sporo też zmieniło się w samej strukturze projektu. Od teraz pogodynka to projekt, który składa się z wielu modułów. Jest to możliwe dzięki dodaniu pliku <a href="https://github.com/SamouczekProgramisty/Pogodynka/blob/master/settings.gradle" target="_blank"><code>settings.gradle</code></a>, który opisuje strukturę takiego projektu.</p>
<p>Jeden z modułów już znasz thermometer. Nowy, który się pojawił to datavault. Dla przypomnienia jest to moduł, który odpowiedzialny będzie za zapisywanie wskazań temperatury w bazie. Udostępniał też będzie usługi, które używane będą przez interfejs użytkownika w przeglądarce internetowej.</p>
<p>Całość na prostym diagramie wygląda następująco:</p>
<p><a href="http://www.samouczekprogramisty.pl/wp-content/uploads/2017/03/diagram_pogodynka.jpg"><img class="aligncenter size-medium wp-image-790" src="http://www.samouczekprogramisty.pl/wp-content/uploads/2017/03/diagram_pogodynka-300x127.jpg" alt="pogodynka diagram" width="300" height="127" /></a></p>
<p>Jeśli chcesz poznać podstawy Gradle zapraszam do <a href="http://www.samouczekprogramisty.pl/wstep-do-gradle/">osobnego artykułu</a>.</p>
<h1>Szablon aplikacji webowej</h1><br />
Moduł datavault będzie aplikacją webową. Aplikacja ta nie będzie posiadała żadnego interfejsu graficznego. Wystawi jedynie usługi, które będą realizowały całą funkcjonalność:</p>
<ul>
<li>zapis aktualnej temperatury,</li>
<li>odczyt temperatur z N ostatnich dni.</li><br />
</ul><br />
Jeśli wcześniej nie miałeś do czynienia z aplikacjami tego typu zachęcam do przeczytania <a href="http://www.samouczekprogramisty.pl/wprowadzenie-do-aplikacji-webowych/">wprowadzenia do aplikacji webowych</a>.</p>
<p>Aktualnie moduł datavault to pusty szablon aplikacji webowej. Całość sprowadza się do pliku datavault.gradle, który definiuje aplikację tego typu:</p>
<pre class="lang:default highlight:0 decode:true ">apply plugin: 'war'<br />
apply from: 'https://raw.github.com/akhikhl/gretty/master/pluginScripts/gretty.plugin'</p>
<p>dependencies {<br />
    providedCompile group: 'javax.servlet', name: 'javax.servlet-api', version: '3.1.0'<br />
}</pre><br />
W pierwszej linijce dodaję rozszerzenie war, dzięki któremu Gradle wie, że jest to aplikacja webowa. Druga linijka dodaje rozszerzenie, które pozwala na wygodne uruchamianie kontenerów aplikacji/serwletów. Dzięki wtyczce gretty w prosty sposób możemy uruchomić taki kontener.</p>
<p>Zachęcam to tego żebyś pobrał kod z <a href="https://github.com/SamouczekProgramisty/Pogodynka" target="_blank">repozytorium</a> i sam spróbował:</p>
<pre class="lang:default highlight:0 decode:true ">$ ./gradlew appRun<br />
:datavault:prepareInplaceWebAppFolder UP-TO-DATE<br />
:datavault:createInplaceWebAppFolder UP-TO-DATE<br />
:datavault:compileJava NO-SOURCE<br />
:datavault:processResources NO-SOURCE<br />
:datavault:classes UP-TO-DATE<br />
:datavault:prepareInplaceWebAppClasses UP-TO-DATE<br />
:datavault:prepareInplaceWebApp UP-TO-DATE<br />
:datavault:appRun<br />
18:48:10 INFO Jetty 9.2.15.v20160210 started and listening on port 8080<br />
18:48:10 INFO datavault runs at:<br />
18:48:10 INFO http://localhost:8080/datavault<br />
Press any key to stop the server.<br />
> Building 87% > :datavault:appRun</pre><br />
Następnie otworzenie w przeglądarce adresu http://localhost:8080/datavault powinno zadziałać :).</p>
<h1>Podsumowanie</h1><br />
Powoli, ale skutecznie idę do przodu :). Jeden z modułów jest gotowy, pozostałe dwa czekają na swoją kolej. Datavautl wezmę na tapetę w kolejnych tygodniach. Na dzisiaj to wszystko z frontu, do następnego razu! :)</p>
<p>[FM_form id="3"]</p>
