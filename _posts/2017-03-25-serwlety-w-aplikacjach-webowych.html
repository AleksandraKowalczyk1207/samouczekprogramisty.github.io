---
layout: post
status: publish
published: true
title: Serwlety w aplikacjach webowych
author:
  display_name: Marcin Pietraszek
  login: marcin
  email: m.pietraszek@gmail.com
  url: ''
author_login: marcin
author_email: m.pietraszek@gmail.com
excerpt: "W artykule tym przeczytasz o serwletach. Poznasz podstawy protokołu HTTP.
  Dowiesz się czym są serwlety i jak je pisać. Dowiesz się także czym jest plik war
  i przeczytasz o jego strukturze. Po lekturze tego artykułu zrozumiesz co kryje się
  pod spodem Spring MVC. Napiszesz też swoją aplikację webową, używającą serwletów.
  Zapraszam do lektury.\r\n\r\n"
wordpress_id: 799
wordpress_url: http://www.samouczekprogramisty.pl/?p=799
date: '2017-03-25 12:11:07 +0100'
date_gmt: '2017-03-25 11:11:07 +0100'
categories:
- DSP2017
- Kurs aplikacji webowych
tags: []
---
<p>W artykule tym przeczytasz o serwletach. Poznasz podstawy protokołu HTTP. Dowiesz się czym są serwlety i jak je pisać. Dowiesz się także czym jest plik war i przeczytasz o jego strukturze. Po lekturze tego artykułu zrozumiesz co kryje się pod spodem Spring MVC. Napiszesz też swoją aplikację webową, używającą serwletów. Zapraszam do lektury.</p>
<p><a id="more"></a><a id="more-799"></a></p>
<p>Chociaż artykuł ten pisany jest z myślą o początkujących do jego pełnego zrozumienia przyda się wiedza, którą zawarłem w kliku innych artykułach. Zachęcam do zapoznania się z nimi przed podejściem do tego artykułu:</p>
<ul>
<li><a href="http://www.samouczekprogramisty.pl/wprowadzenie-do-aplikacji-webowych/">Wstęp do aplikacji webowych</a></li>
<li><a href="http://www.samouczekprogramisty.pl/wstep-do-gradle/">Wstęp do Gradle</a></li>
<li><a href="http://www.samouczekprogramisty.pl/java-z-linii-polecen/">Java z linii poleceń</a></li><br />
</ul><br />
[idea]Artykuł ten bazuje na specyfikacji serwletów w wersji 3.1, która jest częścią specyfikacji Java Enterprise Edition 7. Planowany termin wydania specyfikacji Java Enterprise Edition 8 to koniec 2017 roku, w ramach tej specyfikacji wydana ma być także nowa specyfikacja serwletów w wersji 4.0.[/idea]</p>
<h1>Wprowadzenie do protokołu HTTP</h1><br />
Aby zacząć poważnie myśleć o tworzeniu aplikacji webowych niezbędna jest wiedza dotycząca protokołu HTTP (ang. Hypertext Transfer Protocol). Poniżej znajdziesz kilka podstawowych informacji, które będą Ci potrzebne w pracy z aplikacją webową.</p>
<ul>
<li>Protokół HTTP jest oparty na komunikacji pomiędzy klientem a serwerem. Klientem może być na przykład przeglądarka internetowa. Serwer to aplikacja, która odpowiada na żądania klienta.</li>
<li>Komunikacja pomiędzy klientem a serwerem oparta jest na żądaniach (ang. <em>request</em>) i odpowiedziach (ang. <em>response</em>). Klient wysyła żądanie, na które serwer udziela odpowiedzi.</li>
<li>Zarówno żądania, jak i odpowiedzi mogą zawierać nagłówki i treść. Nagłówki służą do przekazania części informacji. W nagłówku na przykład zawarte mogą być informacje o przeglądarce, z której wysłano żądanie. Treścią odpowiedzi może być na przykład zawartość strony internetowej.</li>
<li>Protokół HTTP oparty jest o tak zwane &ldquo;czasowniki HTTP&rdquo;. Można powiedzieć, że czasownik ten określa rodzaj żądania jakie wysyła klient. Wszystkich czasowników jest 9, podstawowe rodzaje żądań to GET, POST, PUT, DELETE.</li>
<li>W większości przypadków używane są żądania typu GET i POST. Na przykład do wysłania informacji, które uzupełniłeś w formularzu używa się żądania typu POST. Natomiast zwykłe otworzenie strony, wpisanie adresu strony w przeglądarce to żądanie typu GET.</li><br />
</ul></p>
<h2>Adres URL</h2><br />
Każde z żądań dotyczy jakiegoś zasobu. Na przykład otwierając stronę <a href="http://www.samouczekprogramisty.pl">www.samouczekprogramisty.pl</a> w przeglądarce wysyłasz żądanie <code>GET http://www.samouczekprogramisty.pl</code>. Ta część po GET to nic innego jak URL (ang. <em>Uniform Resource Locator</em>). Innymi słowy adres strony www.</p>
<p>Adres URL może składać się z kilku części</p>
<pre class="lang:default highlight:0 decode:true">(scheme://)(user:password@)host(:port)(/)(path)(?query)(#fragment)<br />
http://marcin:tajnehaslo@www.samouczekprogramisty.pl:80/kurs-programowania-java?parametr=wartosc&amp;innyParametr=wartosc#xxx</pre><br />
W ogromnej większości przypadków część z użytkownikiem i hasłem jest pomijana. Używana jest ona do uwierzytelniania, jednak metoda ta nie jest powszechnie używana. Port także jest pomijany. Pomijamy go ponieważ dla protokołu http domyślny port to właśnie 80 więc nie ma potrzeby go dodawać. Odrzucając rzadziej używane elementy adres url wygląda następująco</p>
<pre class="lang:default decode:true">http://www.samouczekprogramisty.pl:80/kurs-programowania-java?parametr=wartosc&amp;innyParametr=wartosc</pre><br />
Mamy tutaj informację o protokole (http), serwerze (www.samouczekprogramisty.pl), ścieżce (/kurs-programowania-java) i parametrach (parametr=wartosc&amp;innyParametr=wartosc).</p>
<h1>Czym jest serwlet</h1><br />
Serwlet to klasa, która implementuje interfejs <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/Servlet.html" target="_blank"><code>Servlet</code></a>. Instancje tej klasy tworzone są przez kontener serwletów (na przykład Jetty). Instancje te wiedzą jak odpowiadać na żądania, które dostają od klienta.</p>
<p>Do obsługi żądania klienta służy metoda <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/Servlet.html#service-javax.servlet.ServletRequest-javax.servlet.ServletResponse-" target="_blank"><code>service</code></a>. Metoda ta przyjmuje jako parametry żądanie i odpowiedź. Na podstawie parametrów żądania odpowiednio modyfikuje przekazany argument odpowiedzi.</p>
<p>Szczerze mówiąc do tej pory ani razu nie napisałem klasy, która bezpośrednio implementuje ten interfejs. Używa się do tego klas, które upraszczają tworzenie serwletów. Są to klasy <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/GenericServlet.html" target="_blank"><code>GenericServlet</code></a> i <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServlet.html" target="_blank"><code>HttpServlet</code></a>.</p>
<p>Chociaż specyfikacja serwletów, nie wymaga użycia serwletów z protokołem HTTP w praktyce nie spotkałem się z innym zastosowaniem. Zatem z dwóch wyżej wspomnianych klas powinieneś zapamiętać <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServlet.html" target="_blank"><code>HttpServlet</code></a>.[0. Prawda jest taka, że używając bibliotek pomagających tworzyć aplikacje webowe sam nie będziesz pisał serwletów. Będą to zwykłe klasy, które będą przez bibliotekę wywoływane. Biblioteka dostarczy &ldquo;główny&rdquo; serwlet, który będzie przekazywał żądania dalej.]</p>
<h1>Interfejs serwletów</h1><br />
Wcześniej wspomniałem Ci już o metodzie <code>service</code>. Metodę tę musiałbyś zaimplementować jeśli utworzyłbyś klasę, która implementuje interfejs <code>Servlet</code> bezpośrednio. W przypadku klasy, która dziedziczy po <code>HttpServlet</code> wystarczy nadpis odpowiednie metody. Na przykład, jeśli twój serwlet ma obsłużyć żądania typu GET musisz zaimplementować metodę <code>doGet</code>. Istnieją też metody dla pozostałych &ldquo;czasowników&rdquo;, na przykład <code>doPost</code> czy <code>doPut</code>.</p>
<p>W interfejsie serwletów znajdują się też metody, które są wykorzystywane w trakcie cyklu życia serwletu. Jak wspomniałem wyżej kontener odpowiedzialny jest za tworzenie instancji serwletu. Ponadto kontener zarządza cyklem życia serwletu używając metod z tego interfejsu.</p>
<h1>Cykl życia serwletu</h1><br />
Każda instancja serwletu ma swój cykl życia. Jest to jasno zdefiniowana lista etapów, przez które przechodzi każdy serwelt. Lista ta wygląda następująco:</p>
<h2>Utworzenie instancji serwletu</h2><br />
Kontener wyszukuje klas serwletów i następnie tworzy jedną instancję serwletu[1. Chodzi o zachowanie domyślne, kontener może utworzyć kilka instancji jeśli zaimplementujesz interfejs SingleThreadedModel. Takie podejście nie jest jednak polecane.].</p>
<h2>Inicjalizacja serwletu</h2><br />
Z racji tego, że to kontener serwletów odpowiedzialny jest za tworzenie instancji klasy serwletu nie ma możliwości przekazania odpowiednich parametrów do konstruktora. Do inicjalizacji stanu serwletu służy metoda <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/Servlet.html#init-javax.servlet.ServletConfig-" target="_blank"><code>init</code></a> i jest ona wywoływana przez kontener przed rozpoczęciem obsługi żądań przez dany serwlet.</p>
<h2>Obsługa żądań</h2><br />
W trakcie tego etapu kontener serwletów może wielokrotnie użyć tej samej instancji to obsługi wielu żądań. Pociąga to za sobą dość poważne konsekwencje. Możliwa jest sytuacja, w której w tym samym czasie instancja serwletu będzie obsługiwała kilka żądań jednocześnie. Na przykład jest to możliwe gdy kilku użytkowników wejdzie na ten sam adres. Obsługa każdego żądania do wywołanie przez kontener metody <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/Servlet.html#service-javax.servlet.ServletRequest-javax.servlet.ServletResponse-" target="_blank"><code>service</code></a>.</p>
<h2>Zniszczenie serwletu</h2><br />
Kontener może usunąć daną instancję serwletu. Przed zniszczeniem instancji wywołana zostanie metoda <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/Servlet.html#destroy--" target="_blank"><code>destroy</code></a>. Dzięki temu wewnątrz serweltu masz szansę na &ldquo;posprzątanie&rdquo;. Metoda ta może na przykład służyć do zamknięcia połączenia z bazą danych. Nie masz pewności jak długo serwlet będzie żył, o tym decyduje kontener.</p>
<h1>Kontener serwletów</h1><br />
Z poprzednich paragrafów dowiedziałeś się już, że kontener serwletów zarządza cyklem życia serwletów. Nie jest to jedyna odpowiedzialność kontenera. Kontener serwletów odpowiedzialny jest za &ldquo;wyszukanie&rdquo; klas odpowiedzialnych za działanie aplikacji.</p>
<p>W pierwszych wersjach specyfikacji niezbędny był do tego plik <code>web.xml</code> (tak zwany deskryptor wdrożenia), teraz aplikację webową można skonfigurować przy pomocy adnotacji. Dalej jednak to kontener musi &ldquo;znaleźć&rdquo; te klasy.</p>
<p>Poza serwletami istnieją też inne komponenty aplikacji webowej opisane w specyfikacji serlwetów. Na przykład filtry czy &ldquo;listnenery&rdquo; (ang. <em>listener</em>) (ma ktoś z was pomysł jak przetłumaczyć to słowo na polski :)?). Także i tutaj kontener serwletów pełni kluczową rolę. Kontener zarządza cyklem życia tych elementów.</p>
<p>Przy konstruowaniu odpowiedzi na żądania pomocne są pliki typu JSP (ang. <em>Java Server Pages</em>). Powtórzę się - kontener zarządza cyklem życia takich plików.</p>
<p>W przypadku aplikacji webowych możemy mówić o kilku kontekstach. Możemy wyróżnić na przykład kontekst żądania czy kontekst aplikacji. Także tutaj kontener serwletów za nie odpowiada.</p>
<p>Jest jeszcze wiele innych aspektów, za które odpowiada kontener wybiegają jednak poza zakres tego artykułu. Napiszę jeszcze o jednym z nich. Kontener także odpowiedzialny jest za instalowanie aplikacji webowej, wiąże się to z &ldquo;czytaniem&rdquo; zawartości pliku war, w którym znajduje się aplikacja webowa.</p>
<h1>Plik war</h1><br />
W artykule opisującym <a href="http://www.samouczekprogramisty.pl/java-z-linii-polecen/">Javę z linii poleceń</a> możesz przeczytać o plikach jar. W przypadku aplikacji webowych plik war pełni kluczową rolę.</p>
<p>W skład aplikacji webowej mogą wchodzić:</p>
<ul>
<li>serwlety,</li>
<li>strony jsp,</li>
<li>inne klasy Java,</li>
<li>zależności aplikacji webowej,</li>
<li>statyczne pliki (na przykład html czy css),</li>
<li>pliki konfiguracyjne opisujące aplikację webową.</li><br />
</ul><br />
Wszystkie te pliki pakowane są w odpowiednią strukturę wewnątrz pliku war.</p>
<h2>Struktura aplikacji webowej</h2><br />
Podobnie jak w przypadku pliku jar jest to zwykłe archiwum zip ze zmienionym rozszerzeniem (war a nie zip). Buduje się go przy pomocy tych samych narzędzi jak plik jar . Struktura przykładowego pliku war jest następująca:</p>
<pre class="lang:default highlight:0 decode:true ">struktura_pliku.war<br />
├── index.html<br />
├── publiczny_katalog<br />
│   └── strona.html<br />
├── style.css<br />
└── WEB-INF<br />
    ├── classes<br />
    │   └── pl<br />
    │   └── samouczekprogramisty<br />
    │   └── SomeServlet.class<br />
    ├── lib<br />
    │   └── some-jar-file.jar<br />
    └── web.xml</pre><br />
Pliki takie jak <code>index.html</code>, <code>publiczny_ktalog/strona.html</code> czy <code>style.css</code> są publicznie dostępne. Oznacza to tyle, że kontener serwletów może serwować te pliki.</p>
<p>Sprawa wygląda zupełnie inaczej w przypadku katalogu <code>WEB-INF</code>. Jest to katalog, który zawiera dane, które nigdy nie mogą być bezpośrednio &ldquo;serwowane&rdquo; przez kontener. Wewnątrz <code>WEB-INF</code> znajdują się inne katalogi:</p>
<ul>
<li><code>classes</code> - zawiera on skompilowane klasy aplikacji webowej,</li>
<li><code>lib</code> - zawiera on spakowane pliki jar potrzebne do działania aplikacji webowej.</li><br />
</ul><br />
Dodatkowo aplikacja webowa może zawierać tak zwany deskryptor wdrożenia (ang. <em>deployment descriptor</em>). Jest to plik <code>web.xml</code>, który konfiguruje działanie aplikacji webowej. W przypadku prostych aplikacji nie jest on wymagany, całą konfigurację można dostarczyć przy pomocy adnotacji.</p>
<h1>Sekret działania Spring MVC</h1><br />
W codziennej pracy z aplikacjami webowymi programiści bardzo rzadko (wcale?) tworzą swoje serwlety. W ogromnej większości przypadków to biblioteka pomagająca przybudowaniu aplikacji webowych zawiera &ldquo;główny serwlet&rdquo;.</p>
<p>Ten serwlet pośredniczy przy wszystkich zapytaniach do danej aplikacji webowej. Następnie w zależności od ścieżki, której dotyczy dane żądanie przekazuje je do odpowiedniej klasy. I to właśnie te klasy pisane są przez programistów.</p>
<p>Dla przykładu w Spring MVC takim &ldquo;głównym serwletem&rdquo; jest <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-webmvc/src/main/java/org/springframework/web/servlet/DispatcherServlet.java" target="_blank"><code>DispatcherServlet</code></a>. Zachęcam do zajrzenia do źródeł tego serwletu. Zobaczyć możesz tam jakie mechanizmy użyte są do przekazania żądania dalej.</p>
<p>Jak przeszukasz <code>DispatcherServlet</code> i klasy po których dziedziczy dogrzebiesz się do dobrze znanych metod, takich jak <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-webmvc/src/main/java/org/springframework/web/servlet/FrameworkServlet.java#L833" target="_blank"><code>service</code></a> czy <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-webmvc/src/main/java/org/springframework/web/servlet/FrameworkServlet.java#L853" target="_blank"><code>doGet</code></a>.</p>
<h1>Pierwsza aplikacja webowa</h1><br />
Nadszedł czas, żeby wykorzystać tę wiedzę w praktyce. Proszę spójrz na przykład poniżej:</p>
<pre class="lang:default decode:true ">@WebServlet("/date")<br />
public class DateServlet extends HttpServlet {<br />
    @Override<br />
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {<br />
        DateTime now = DateTime.now();<br />
        PrintWriter responseOutput = response.getWriter();<br />
        responseOutput.append("<html><body>" + now.toString() + "</body></html>");<br />
    }<br />
}</pre><br />
<a href="https://github.com/SamouczekProgramisty/KursAplikacjeWebowe/blob/master/01_serwlety/src/main/java/pl/samouczekprogramisty/kursaplikacjewebowe/servlets/DateServlet.java" target="_blank"><code>DateServlet</code></a> to serwlet, który odpowiada na żądania typu GET wysłane na adres <code>/date</code>. Oczywiście w produkcyjnych aplikacjach w inny sposób konstruuje się odpowiedzi, jednak przykład ten pokazuje ogólną zasadę działania.</p>
<p><code>response.getWriter()</code> zwraca instancję klasy <code>PrintWriter</code>. Należy traktować ją jako zawartość pliku, która zostanie wysłana w odpowiedzi na żądanie. Jeśli użyjemy tej metody odpowiedź, którą wygenerujemy musi być tekstowa (nie binarna). Ostatnia linijka metody <code>doGet</code> to właśnie generowanie treści odpowiedzi, gdzie odpowiadamy aktualną datą umieszczoną wewnątrz podstawowych znaczników html.</p>
<p>Taką klasę serwletu umieszczamy w projekcie. W moim przypadku jego struktura wygląda następująco:</p>
<pre class="lang:default highlight:0 decode:true ">.<br />
├── 01_serwlety<br />
│   ├── build<br />
│   ├── build.gradle<br />
│   └── src<br />
│   └── main<br />
│   ├── java<br />
│   │   └── pl<br />
│   │   └── samouczekprogramisty<br />
│   │   └── kursaplikacjewebowe<br />
│   │   └── serwlety<br />
│   │   └── DateServlet.java<br />
│   └── webapp<br />
├── build.gradle<br />
├── gradle<br />
│   └── wrapper<br />
│   ├── gradle-wrapper.jar<br />
│   └── gradle-wrapper.properties<br />
├── gradlew<br />
├── gradlew.bat<br />
└── settings.gradle</pre><br />
Na tym etapie proszę użyj przykładowych plików umieszczonych w <a href="https://github.com/SamouczekProgramisty/KursAplikacjeWebowe" target="_blank">repozytorium kodu</a>. W osobnym artykule wytłumaczę zasadę działania Gradle w przypadku aplikacji webowych. Bazowy plik <a href="https://github.com/SamouczekProgramisty/KursAplikacjeWebowe/blob/master/build.gradle" target="_blank"><code>build.gradle</code></a> i plik <a href="https://github.com/SamouczekProgramisty/KursAplikacjeWebowe/blob/master/01_serwlety/build.gradle" target="_blank"><code>01_serwlety/build.gradle</code></a> pozwalają na uruchomienie tak utworzonej aplikacji webowej:</p>
<pre class="lang:default highlight:0 decode:true">KursAplikacjeWebowe$ ./gradlew appRun<br />
:01_serwlety:prepareInplaceWebAppFolder NO-SOURCE<br />
:01_serwlety:createInplaceWebAppFolder UP-TO-DATE<br />
:01_serwlety:compileJava UP-TO-DATE<br />
:01_serwlety:processResources NO-SOURCE<br />
:01_serwlety:classes UP-TO-DATE<br />
:01_serwlety:prepareInplaceWebAppClasses UP-TO-DATE<br />
:01_serwlety:prepareInplaceWebApp UP-TO-DATE<br />
:01_serwlety:appRun<br />
10:19:57 INFO Jetty 9.2.15.v20160210 started and listening on port 8080<br />
10:19:57 INFO 01_serwlety runs at:<br />
10:19:57 INFO http://localhost:8080/01_serwlety<br />
Press any key to stop the server.<br />
> Building 87% > :01_serwlety:appRun</pre><br />
Następnie uruchomienie przeglądarki i wpisanie adresu <code>http://localhost:8080/01_serwlety/date</code> powinno pokazać działającą aplikację, która wyświetla datę:</p>
<p><a href="http://www.samouczekprogramisty.pl/wp-content/uploads/2017/03/przegladarka_odpowiedz.jpeg"><img class="aligncenter size-medium wp-image-800" src="http://www.samouczekprogramisty.pl/wp-content/uploads/2017/03/przegladarka_odpowiedz-300x181.jpeg" alt="dateservlet odpowiedz" width="300" height="181" /></a></p>
<h1>Ćwiczenie do wykonania</h1><br />
Na podstawie <a href="https://github.com/SamouczekProgramisty/KursAplikacjeWebowe/tree/master/01_serwlety" target="_blank">przykładowej aplikacji</a> napisz serwlet, który wyświetli liczbę sekund, od dnia Twojego urodzenia. Po wejściu na stronę, którą obsługuje dany serwlet powinna pokazać się liczba sekund, od Twoich urodzin.</p>
<h1>Dodatkowe materiały do nauki</h1><br />
Poniżej przygotowałem dla Ciebie kilka dodatkowych linków, które pomogą Ci rozszerzyć wiedzę z tego artykułu:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol" target="_blank">Protokół HTTP</a></li>
<li><a href="https://jcp.org/en/jsr/detail?id=340" target="_blank">Specyfikacja serwletów wersja 3.1</a></li>
<li><a href="http://www.oracle.com/technetwork/java/javaee/tech/index.html" target="_blank">Specyfikacje Java EE 7</a></li>
<li><a href="https://github.com/SamouczekProgramisty/KursAplikacjeWebowe/tree/master/01_serwlety" target="_blank">Przykłady użyte w tym artykule</a></li><br />
</ul></p>
<h1>Podsumowanie</h1><br />
Gratulacje! Udało Ci się przeczytać cały artykuł, a nie należał on do najkrótszych ;). Po jego przeczytaniu wiesz czym jest serwlet. Poznałeś strukturę pliku war, znasz podstawowy zakres odpowiedzialności kontenera serwletów. Poznałeś też część magii, która kryje się pod spodem biblioteki Spring MVC. No i oczywiście utworzyłeś swoją pierwszą dynamiczną aplikację webowową!</p>
<p>Mimo objętości artykułu nie wyczerpałem tematu aplikacji webowych, jest to jeden z serii artykułów opisujących podstawy aplikacji webowych w Javie. Jeśli nie chcesz pominąć kolejnych artykułów polub Samouczka na facebooku i zapisz się do newslettera.</p>
<p>Do następnego razu!</p>
<p>[FM_form id="3"]</p>
<p>Zdjęcie dzięki uprzejmości https://www.flickr.com/photos/rafa2010/15353313381/sizes/l</p>
