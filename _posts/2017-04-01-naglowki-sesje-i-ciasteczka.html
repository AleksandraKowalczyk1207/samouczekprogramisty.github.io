---
layout: post
status: publish
published: true
title: Nagłówki, sesje i ciasteczka
author:
  display_name: Marcin Pietraszek
  login: marcin
  email: m.pietraszek@gmail.com
  url: ''
author_login: marcin
author_email: m.pietraszek@gmail.com
excerpt: "W pierwszej części artykułu opisującej serwlety dowiedziałeś się podstaw
  dotyczących serwletów. W tym artykule będziesz mógł poszerzyć tę wiedzę.
  Dowiesz się jakie możliwości dają klasy <code>HttpServletRequest</code> i <code>HttpServletResponse</code>.
  Wyjaśnię Ci czym jest sesja i jak pracować z <code>HttpSession</code>. Przeczytasz
  także o nagłówkach i ciasteczkach, nauczysz się tworzyć je samodzielnie.
  Na końcu czeka także ćwiczenie, w którym zastosujesz wiedzę w praktyce. Zapraszam
  do lektury.\r\n\r\n"
wordpress_id: 817
wordpress_url: http://www.samouczekprogramisty.pl/?p=817
date: '2017-04-01 15:57:24 +0200'
date_gmt: '2017-04-01 13:57:24 +0200'
categories:
- DSP2017
- Kurs aplikacji webowych
tags: []
---
<p>W pierwszej części artykułu opisującej serwlety dowiedziałeś się podstaw dotyczących serwletów. W tym artykule będziesz mógł poszerzyć tę wiedzę. Dowiesz się jakie możliwości dają klasy <code>HttpServletRequest</code> i <code>HttpServletResponse</code>. Wyjaśnię Ci czym jest sesja i jak pracować z <code>HttpSession</code>. Przeczytasz także o nagłówkach i ciasteczkach, nauczysz się tworzyć je samodzielnie. Na końcu czeka także ćwiczenie, w którym zastosujesz wiedzę w praktyce. Zapraszam do lektury.</p>
<p><a id="more"></a><a id="more-817"></a></p>
<p>Zacznijmy od żądań i odpowiedzi. Wiesz już, o hierarchii dziedziczenia serwletów <code>Servlet</code>, <code>GenericServlet</code> i <code>HttpServlet</code>. W przypadku klasy opakowującej żądanie i odpowiedź sytuacja wygląda podobnie. Istnieją bazowe interfejsy <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletRequest.html" target="_blank"><code>ServeltRequest</code></a> i <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletResponse.html" target="_blank"><code>ServletResponse</code></a>.</p>
<p>W przypadku serwletów opartych o protokół HTTP interfejsy te są rozszerzane przez <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html" target="_blank"><code>HttpServletRequest</code></a> i <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletResponse.html" target="_blank"><code>HttpServletResponse</code></a>. Rozszerzone interfejsy zawierają metody specyficzne dla protokołu HTTP.</p>
<p>Zauważ, że piszę tu wyłącznie o interfejsach. Są to interfejsy określone przez specyfikację serwletów. Kontener serwletów, który implementuję tę specyfikację dostarcza także konkretnych implementacji. To właśnie kontener odpowiedzialny jest za tworzenie instancji klas, które implementują te interfejsy.</p>
<p>Z <a href="http://www.samouczekprogramisty.pl/serwlety-w-aplikacjach-webowych/">poprzedniego artykułu opisującego serwlety</a> wiesz już z jakich elementów składa się adres URL. Klasy opakowujące żądanie pozwalają na pracę z poszczególnymi elementami adresu URL. Jedą z części tego adresu są parametry.</p>
<p>[warning]W artykule i przykładach używam bardzo prostego mechanizmu do generowania widoków. Nie jest to sposób "poprawny". To są jedynie przykłady, które mają wprowadzić Cię w &ldquo;świat aplikacji webowych&rdquo;. W kolejnych artykułach poznasz lepszą metodę na generowanie stron HTML.[/warning]</p>
<h1><code>HTTPServletRequest</code></h1></p>
<h2>Parametry URL</h2><br />
Jedną z części adresu URL są parametry. Są one dostępne po znaku <code>?</code>. Parametry zapisane są w formie klucz=wartość, z tym że jeden parametr może wystąpić wiele razy. Poszczególne pary klucz=wartość rozdzielone są znakami <code>&amp;</code>.</p>
<p>W interfejsie <code>HttpServletRequest</code> istnieje kilka metod, które pozwalają na pracę z parametrami. Proszę spójrz na przykład poniżej.</p>
<pre class="lang:default decode:true ">@WebServlet("/parameters")<br />
public class ParametersServlet extends HttpServlet {<br />
    @Override<br />
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {<br />
        PrintWriter responseWriter = resp.getWriter();<br />
        responseWriter.write("<html><body>");<br />
        for (Map.Entry<String, String[]> entry : req.getParameterMap().entrySet()) {<br />
            responseWriter.write("
<p>" + entry.getKey() + ": " + Arrays.toString(entry.getValue()) +"</p>");<br />
        }<br />
        responseWriter.write("</body></html>");<br />
    }<br />
}</pre><br />
W przykładzie tym widzisz serwlet, który w odpowiedzi wypisuje wszystkie parametry z adresu URL żądania. Poza metodą <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletRequest.html#getParameterMap--" target="_blank"><code>getParameterMap</code></a> możesz użyć także kilku innych:</p>
<ul>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletRequest.html#getParameter-java.lang.String-" target="_blank"><code>getParameter()</code></a></li>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletRequest.html#getParameterNames--" target="_blank"><code>getParameterNames()</code></a></li>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletRequest.html#getParameterValues-java.lang.String-" target="_blank"><code>getParameterValues()</code></a></li><br />
</ul><br />
Po uruchomieniu aplikacji, która posiada taki serwlet i wpisaniu w przeglądarce adresu</p>
<pre class="lang:default highlight:0 decode:true ">http://localhost:8080/02_serwlety/parameters?parameter1=value1&amp;parameter2=value2&amp;parameter1=value11</pre><br />
Powinna wyświetlić się strona zawierająca dwie linijki:</p>
<pre class="lang:default highlight:0 decode:true ">parameter2: [value2]<br />
parameter1: [value1, value11]</pre></p>
<h3>Żądania POST a parametry</h3><br />
Powyżej opisałem sytuację, w której parametry przesyłane są jako fragment adresu URL żądania. Dzieje się tak w przypadku żądań typu GET. W przypadku wysyłania formularzy (zazwyczaj zapytania typu POST), parametry te przesyłane są w ciele żądania. Nie są one częścią adresu.</p>
<p>Mimo tego, że parametry przesyłane są w inny sposób możesz z nimi pracować używając tego samego zestawu metod.</p>
<h2>Adres URL</h2><br />
Obiekt opakowujący żądanie pozwala także na pracę z adresem URL, którego żądanie dotyczy. Zestaw metod pozwala na pobranie informacji na temat adresu żądania:</p>
<ul>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html#getContextPath--" target="_blank"><code>getContextPath()</code></a> zwraca fragment ścieżki, która jest &ldquo;podstawą&rdquo; wszystkich ścieżek obsługiwanych przez daną aplikację. W przypadku prostego instalowania aplikacji przy pomocy gradle będzie to nazwa pliku war,</li>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html#getServletPath--" target="_blank"><code>getServletPath()</code></a>&nbsp; zwraca fragment ścieżki, która została użyta w konfiguracji serwletu,</li>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html#getRequestURL--" target="_blank"><code>getRequestURL()</code></a>&nbsp; metoda zwraca adres URL żądania bez parametrów zawartych w adresie,</li>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html#getRequestURI--" target="_blank"><code>getRequstURI()</code></a>&nbsp; zwraca adres URI (ang. <em>Uniform Resource Identifier</em>). Od aresu URL różni się on tym, że nie zawiera protokołu, serwera i portu.</li><br />
</ul><br />
Zakładając, że nasz sewlet obsługuje ścieżkę /path wówczas wywołanie powyższych metod po żądaniu</p>
<pre class="lang:default highlight:0 decode:true ">http://localhost:8080/02_serwlety/path?xxx=yyy zwróci następujące wartości</pre><br />
Powinno zwrócić następujące wartości:</p>
<ul>
<li><code>getContextPath() /02_serwlety</code></li>
<li><code>getServletPath() /path</code></li>
<li><code>getRequestURI() /02_serwlety/path</code></li>
<li><code>getRequestURL() http://localhost:8080/02_serwlety/path</code></li><br />
</ul><br />
Przykładowy serwlet, który używa tych metod możesz znaleźć na <a href="https://github.com/SamouczekProgramisty/KursAplikacjeWebowe/blob/master/02_serwlety/src/main/java/pl/samouczekprogramisy/kursaplikacjewebowe/servlets/PathServlet.java" target="_blank">samouczkowym githubie</a>.</p>
<h1><code>HttpServletResponse</code></h1><br />
Obiekt, implementujący ten interfejs także tworzony jest przez kontener serwletów. Służy on do przygotowania odpowiedzi na żądanie wysłane do serwera. W przypadku obiektu odpowiedzi musisz wiedzieć o następujących metodach</p>
<ul>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletResponse.html#getOutputStream--" target="_blank"><code>getOutputStream()</code></a> zwraca instancję <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletOutputStream.html" target="_blank"><code>ServletOutputStream</code></a>, która służy do tworzenia odpowiedzi zawierającej dane binarne,</li>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletResponse.html#getWriter--" target="_blank"><code>getWriter()</code></a>&nbsp;zwraca instancję <code>PrintWriter</code>, która służy do tworzenia odpowiedzi zawierającej tekst.</li><br />
</ul><br />
Ważne jest aby pamiętać, że w trakcie obsługi żądania możemy posługiwać się wyłącznie jedną z tych metod.</p>
<h1>Nagłówki</h1><br />
Specyfikacja protokołu HTTP definiuje tak zwane nagłówki. Nagłówki dołączane są zarówno do żądań jak i odpowiedzi. Nagłówki to nic innego jak pary klucz-wartość, które zapisane są w formacie <code>nazwa nagłówka: treść nagłówka</code>. Na przykład</p>
<pre class="lang:default highlight:0 decode:true">Content-Type: text/html; charset=utf-8<br />
Content-Length: 13358</pre><br />
Przeglądarki internetowe posiadają wbudowane &ldquo;narzędzia developerskie&rdquo;, które pozwalają na podejrzenie nagłówków. Jeśli chcesz dowiedzieć się więcej o tych narzędziach zachęcam do odwiedzenia strony dedykowanej dla Twojej przeglądarki</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Tools" target="_blank">Firefox</a></li>
<li><a href="https://developer.chrome.com/devtools" target="_blank">Chrome </a></li>
<li><a href="http://www.opera.com/dragonfly/" target="_blank">Opera </a></li>
<li><a href="https://docs.microsoft.com/en-us/microsoft-edge/f12-devtools-guide" target="_blank">Internet Explorer</a></li><br />
</ul><br />
<a href="http://www.samouczekprogramisty.pl/wp-content/uploads/2017/04/headers.jpg"><img class="aligncenter size-medium wp-image-821" src="http://www.samouczekprogramisty.pl/wp-content/uploads/2017/04/headers-300x178.jpg" alt="narzędzia developerskie nagłówki" width="300" height="178" /></a></p>
<p>Obiekty <code>HttpServletResponse</code> i <code>HttpServletRequest</code> pozwalają na pracę z nagłówkami przy pomocy metod:</p>
<ul>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletResponse.html#setHeader-java.lang.String-java.lang.String-" target="_blank"><code>setHeader()</code></a></li>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletResponse.html#addHeader-java.lang.String-java.lang.String-" target="_blank"><code>addHeader()</code></a></li><br />
</ul><br />
Pierwsza z nich ustawia wartość nagłówka, druga dodaje nową wartość nagłówka (i tworzy go jeśli wcześniej nie był ustawiony). W rzeczywistości nagłówek mający wiele wartości to dalej jedna para klucz-wartość. W tym przypadku wartość zawiera kilka elementów oddzielonych przecinkami.</p>
<p>Nagłówki możesz pobierać z obiektu żądania używając metod:</p>
<ul>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html#getHeaderNames--" target="_blank"><code>getHeaderNames()</code></a></li>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletResponse.html#getHeader-java.lang.String-" target="_blank"><code>getHeader()</code></a></li>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html#getHeaders-java.lang.String-" target="_blank"><code>getHeaders()</code></a></li><br />
</ul><br />
Poniższy serwlet używa tych metod aby ustawić kilka nagłówków. W odpowiedzi na żadanie twoży stronę, która zawiera listę ustawionych nagłówków. Jak zwykle mocno zachęcam do eksperymentowania, sam zobacz jak taki serwlet działa.</p>
<pre class="lang:default decode:true ">@Override<br />
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {<br />
    PrintWriter responseWriter = resp.getWriter();</p>
<p>    responseWriter.write("<html><body>");<br />
    Enumeration<String> headerNames = req.getHeaderNames();<br />
    while (headerNames.hasMoreElements()) {<br />
        String headerName = headerNames.nextElement();<br />
        Enumeration<String> headerValues = req.getHeaders(headerName);<br />
        while (headerValues.hasMoreElements()) {<br />
            String headerValue = headerValues.nextElement();<br />
            responseWriter.write("
<p>" + headerName + ": " + headerValue + "</p>");<br />
        }<br />
    }</p>
<p>    resp.addHeader("my-custom-header", "value1");<br />
    resp.addHeader("my-custom-header", "value2");<br />
    resp.setIntHeader("my-custom-int-header", 123);</p>
<p>    responseWriter.write("</body></html>");<br />
}</pre></p>
<h2>Zastosowanie nagłówków</h2><br />
Nagłówki jako część protokołu HTTP pełnią bardzo istotną rolę. Dla przykładu poniżej pokazuję zestaw nagłówków wysyłanych wraz z każdą odpowiedzią dla adresu www.samouczekprogramisty.pl:</p>
<pre class="lang:default highlight:0 decode:true">$ curl -I www.samouczekprogramisty.pl<br />
HTTP/1.1 200 OK<br />
Set-Cookie: PHPSESSID=xxxxxxxxxxxxxxxxxxxxxx; path=/<br />
Expires: Thu, 19 Nov 1981 08:52:00 GMT<br />
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0<br />
Pragma: no-cache<br />
Content-Type: text/html; charset=UTF-8<br />
Link: <http://www.samouczekprogramisty.pl/wp-json/>; rel="https://api.w.org/"<br />
Date: Sun, 02 Apr 2017 10:46:08 GMT<br />
Accept-Ranges: bytes<br />
Server: LiteSpeed<br />
Connection: Keep-Alive</pre><br />
Użyłem do tego programu <code>curl</code>, który pozwala na wysyłanie żądań HTTP z linii poleceń. Fragment powyżej powoduje wysłanie żądania typu HEAD, które zwraca wyłącznie nagłówki (bez właściwej zawartości strony). Przykładowe zastosowanie nagłówków:</p>
<ul>
<li>Pozwalają na ustawianie ciasteczek (przeczytasz o nich w kolejnym akapicie) (<code>Set-Cookie</code>),</li>
<li>Pozwalają na określenie zawartości strony. To dzięki nim przeglądarka wie jak interpretować odpowiedź, którą dostanie. To nagłówek określa czy w odpowiedzi znajduje się plik HTML (<code>Content-Type: text/html; charset=UTF-8</code>). Czy może są dane binarne reprezentujące obrazek do wyświetlenia (<code>Content-Type: image/jpeg</code>),</li>
<li>Mogą przyspieszyć ładowanie strony w przeglądarce. Jeśli odwiedziłeś już jakąś stronę to przeglądarka mogła zapisać część danych, które wyświetliła (w tym część nagłówków). Następnym razem nie wyśle żądania typu GET (aby pobrać całą zawartość) a jedynie HEAD (aby pobrać nagłówki). Po sprawdzeniu nagłówków stwierdzi, że dane się nie zmieniły i wyświetli poprzednio zapamiętaną zawartość (<code>Cache-Control: public, max-age=63115200</code>, <code>Last-Modified: Thu, 16 Mar 2017 17:12:14 GMT</code>).</li>
<li>Takie sprawdzenie może odbyć się też w inny sposób. Przeglądarka może wysłać zapytanie typu GET dołączając odpowiednie nagłówki. Później żądanie z nagłówkami interpretowane jest przez serwer. Jeśli serwer stwierdzi, że przeglądarka ma aktualną treść (potwierdza to nagłówek), wówczas wysyła odpowiedź informującą przeglądarkę, że jej kopia treści jest najnowsza. W takim przypadku zamiast przesyłać przez sieć obrazek o wielkości 400kB wysyła odpowiedź, która ma dużo mniej danych - kilka kilobajtów (<code>ETag: "9db5f14aeaa00872"</code>,</li>
<li>Nagłówki to metadane (dane o danych). Zdarza się, że są wykorzystywane do przesyłania dodatkowych informacji na temat danego żądania/odpowiedzi.</li><br />
</ul><br />
Mimo tego, że nagłówki są powszechnie stosowane w codziennej pracy z aplikacjami webowymi (szczególnie na początku) nie są one "kluczowe". Większość z nich ustawiają za nas biblioteki zewnętrzne. Niemniej jednak dobrze jest wiedzieć o tym, że istnieją i do czego służą.</p>
<h1>Ciasteczka</h1><br />
Ciasteczka to mechanizm opisany w specyfikacji protokołu HTTP. W uproszczeniu można powiedzieć, że ciasteczka to informacje, które dołączane są do żądania i mogą być ustawiane w odpowiedzi. Ciasteczka połączone są z adresem, pod który wysyłane jest żądanie. Przeglądarka internetowa wysyłając żądanie pod adres www.samouczekprogramisty.pl wyszukuje jakie ciasteczka ma zapisane dla tej domeny i dołącza je automatycznie do każdego żądania.</p>
<p><a href="http://www.samouczekprogramisty.pl/wp-content/uploads/2017/04/ciasteczka-diagram.jpeg"><img class="aligncenter size-medium wp-image-822" src="http://www.samouczekprogramisty.pl/wp-content/uploads/2017/04/ciasteczka-diagram-300x138.jpeg" alt="ciasteczka diagram" width="300" height="138" /></a></p>
<p>Po stronie serwera, w odpowiedzi można ustawiać ciasteczka. Można to robić przy pomocy nagłówka <code>Set-Cookie</code>. Z racji tego, że jest to bardzo popularny mechanizm istnieje osobny zestaw metod, które pomagają pracować z ciasteczkami:</p>
<ul>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletResponse.html#addCookie-javax.servlet.http.Cookie-" target="_blank"><code>addCookie()</code></a></li>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html#getCookies--" target="_blank"><code>getCookies()</code></a></li><br />
</ul><br />
Samo ciasteczko reprezentowane jest przez klasę <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/Cookie.html" target="_blank"><code>Cookie</code></a>. Podstawowymi atrybutami ciasteczka jest jego nazwa i wartość.</p>
<p>Dodatkowo możesz ustawić też inne atrybuty, takie jak czas życia ciasteczka. Jeśli jest on ustawiony, wówczas przeglądarka dołącza ciasteczka do żądań tak długo jak są one &ldquo;ważne&rdquo;.</p>
<p>Przykładowy serwlet poniżej w odpowiedzi generuje stronę, która wyświetla wszystkie dostępne ciasteczka. Ustawia też jedno ciasteczko o nazwie custom-cookie, jego czas życia ustawiony jest na 10 sekund.</p>
<pre class="lang:default decode:true">@Override<br />
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {<br />
    PrintWriter responseWriter = resp.getWriter();</p>
<p>    responseWriter.write("<html><body>");<br />
    for (Cookie cookie : req.getCookies()) {<br />
        responseWriter.write("
<p>" + cookie.getName() + " " + cookie.getValue() + "</p>");<br />
    }</p>
<p>    Cookie cookie = new Cookie("custom-cookie", "bum bum cyk cyk");<br />
    cookie.setMaxAge(10);<br />
    resp.addCookie(cookie);</p>
<p>    responseWriter.write("</body></html>");<br />
}</pre><br />
Przy drugim otworzeniu strony generowanej przez ten serwlet [1. jeśli zrobisz to szybciej niż 10 sekund po pierwszym wywołaniu] zobaczysz ciasteczko custom-cookie</p>
<p>Wcześniej opisane narzędzia developerskie dostępne w przeglądarkach internetowych pozwalają na podejrzenie zawartości ciasteczek.<br />
<a href="http://www.samouczekprogramisty.pl/wp-content/uploads/2017/04/cookies.png"><img class="aligncenter size-medium wp-image-820" src="http://www.samouczekprogramisty.pl/wp-content/uploads/2017/04/cookies-300x178.png" alt="narzędzia developerskie ciasteczka" width="300" height="178" /></a></p>
<h2>Zastosowanie ciasteczek</h2><br />
Jak wiesz z poprzedniego artykułu protokół HTTP jest bezstanowy. Ciasteczka pomagają obejść tę właściwość. Bardzo często ciasteczka wykorzystywane są do zapisania informacji czy użytkownik jest zalogowany w aplikacji. Aplikacja sprawdza czy takie ciasteczko istnieje, jeśli tak udostępnia użytkownikowi jakieś dane. Jeśli ciasteczka brakuje wówczas przekierowuje go na stronę logowania.</p>
<p>Po zalogowaniu aplikacja ustawia ciasteczko, które następnie dołączane jest do kolejnych żądań automatycznie.</p>
<p>Użytkownik ma możliwość ustawienia przeglądarki internetowej w ten sposób aby nie zapamiętywała ciasteczek. Nie jest to popularne, ale warto wiedzieć, że jest taka możliwość.</p>
<p>Podobnie jak w przypadku nagłówków - w codziennej pracy z aplikacjami webowymi często nie używa się ciasteczek bezpośrednio. Dzieje się to niejako "pod spodem" - zewnętrzne biblioteki wykorzystują ten mechanizm.</p>
<h1>Sesja</h1><br />
Można powiedzieć, że sesja to połączenie kilku żądań/odpowiedzi w jedną całość. Dzięki temu aplikacja webowa może powiązać te żądania z jednym użytkownikiem. Sesje najczęściej zaimplementowane są przy pomocy ciasteczek. Specyfikacja serwletów określa nawet domyślną nazwę takiego ciasteczka - jest to <code>JSESSIONID</code>.</p>
<p>Innym mechanizmem, na którym może być oparta sesja jest przepisywanie adresu URL (ang. <em>URL rewriting</em>). Polega ono na dołączaniu identyfikatora sesji do adresu. W takim przypadku adres może wyglądać następująco <code>http://www.samouczekprogramisty.pl/kurs-programowania-java;jsessionid=1234</code>. To kontener serwletów decyduje o metodzie, która powinna być użyta do &ldquo;podtrzymywania&rdquo; sesji.</p>
<p>Podobnie jak w przypadku ciasteczek sesja ma swój dedykowany obiekt. Po stronie serwera sesja reprezentowana jest przez <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSession.html" target="_blank"><code>HttpSession</code></a>.</p>
<h2>Czas trwania sesji</h2><br />
Sesja nie jest trzymana wiecznie. To jak długo powinna być utrzymywana przez kontener serwletów określone jest przez parametr metody <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSession.html#setMaxInactiveInterval-int-" target="_blank"><code>setMaxInactiveInterval</code></a>. Określa on w sekundach jak długo pomiędzy żądaniami klienta sesjsa powinna być utrzymywana.</p>
<h2>Atrybuty sesji</h2><br />
Sesję można porównać do mapy, w której przechowujemy pary klucz-wartość. Są to atrybuty sesji. Dzięki nim mamy możliwość przekazywania informacji wewnątrz aplikacji webowej pomiędzy żądaniami klienta. Poniższy zestaw metod pozwala na pracę z atrybutami sesji:</p>
<ul>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSession.html#getAttributeNames--" target="_blank"><code>getAttributeNames()</code></a></li>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSession.html#getAttribute-java.lang.String-" target="_blank"><code>getAttribute()</code></a></li>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSession.html#removeAttribute-java.lang.String-" target="_blank">removeAttribute()<code></code></a></li>
<li><a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSession.html#setAttribute-java.lang.String-java.lang.Object-" target="_blank">setAttribute()<code></code></a></li><br />
</ul><br />
Wartościami atrybutów są obiekty, jednak musisz pamiętać o tym aby nie były one &ldquo;duże&rdquo;. Atrybuty sesji powinny być także serializowalne. Jeśli nie miałeś do czynienia z serializacją zapraszam do artykułu poświęconemu <a href="http://www.samouczekprogramisty.pl/serializacja-w-jezyku-java/">serializacji w języku Java</a>.</p>
<h2>Mechanizm przechowywania sesji</h2><br />
Sesje mogą być przechowywane w pamięci kontenera serwletów. Nie jest to jedyna metoda ich przechowywania. Naiwny mechanizm może być oparty o ciasteczka, w takim przypadku wszystkie atrybuty sesji byłyby ciasteczkami.</p>
<p>Kontener serwletów do zapisywania sesji może użyć standardowych plików. Sesja może być także zapisana w różnych bazach danych. To w jaki sposób będzie to realizowane zależy od konfiguracji kontenera serwletów. W podstawowych przypadkach nie musisz się przejmować tą konfiguracją.</p>
<pre class="lang:default decode:true">@WebServlet("/session")<br />
public class SessionServlet extends HttpServlet {</p>
<p>    public static final String VISIT_COUNTER_ATTR = "visitCounter";</p>
<p>    @Override<br />
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {<br />
        PrintWriter responseWriter = resp.getWriter();</p>
<p>        responseWriter.write("<html><body>");</p>
<p>        HttpSession session = req.getSession();<br />
        Enumeration<String> attributeNames = session.getAttributeNames();<br />
        while (attributeNames.hasMoreElements()) {<br />
            String attributeName = attributeNames.nextElement();<br />
            responseWriter.write("
<p>" + attributeName + ": " + session.getAttribute(attributeName) + "</p>");<br />
        }<br />
        responseWriter.write("</body></html>");<br />
        increaseVisitCounter(session);<br />
    }</p>
<p>    private void increaseVisitCounter(HttpSession session) {<br />
        Object counter = session.getAttribute(VISIT_COUNTER_ATTR);<br />
        Integer numberOfVisits;<br />
        if (counter != null) {<br />
            numberOfVisits = (Integer) counter + 1;<br />
        }<br />
        else {<br />
            numberOfVisits = 1;<br />
        }<br />
        session.setAttribute(VISIT_COUNTER_ATTR, numberOfVisits);<br />
    }<br />
}</pre></p>
<h1>Ćwiczenie do wykonania</h1><br />
Napisz serwlet, który pobierze wartość wszystkich parametrów przekazanych w adresie. Pobierze wszystkie parametry, których wartości są liczbami całkowitymi, następnie sumę tych parametrów wyświetli na ekranie. Serwlet ten powinien dodatkowo w sesji zapamiętać sumaryczną wartość wszystkich takich operacji. Ta całkowita suma także powinna być wyświetlona</p>
<p>Na przykład, pierwsze żądanie pod adres <code>/serwlet?parametr=123&amp;inny-parametr=abc&amp;test=-3</code> powinno wyświetlić stronę:</p>
<pre class="lang:default highlight:0 decode:true">requestSum: 120<br />
totalSum: 120</pre><br />
Kolejne żądanie pod adres <code>/serwlet?parametr=336</code> powinno wyświetlić stornę</p>
<pre class="lang:default highlight:0 decode:true ">requestSum: 336<br />
totalSum: 456</pre><br />
W przypadku jakichkolwiek problemów z wykonaniem ćwiczenia możesz rzucić okiem na <a href="https://github.com/SamouczekProgramisty/KursAplikacjeWebowe/blob/master/02_serwlety/src/main/java/pl/samouczekprogramisy/kursaplikacjewebowe/servlets/exercise/ExerciseServlet.java" target="_blank">przykładowe rozwiązanie</a>.</p>
<h1>Dodatkowe materiały do nauki</h1></p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/HTTP_cookie" target="_blank">Artykuł na wikipedi na temat ciasteczek</a>,</li>
<li><a href="https://en.wikipedia.org/wiki/List_of_HTTP_header_fields" target="_blank">Lista standardowych nagłówków HTTP</a>,</li>
<li><a href="http://download.oracle.com/otndocs/jcp/servlet-3_1-fr-eval-spec/index.html" target="_blank">Specyfikacja serwletów</a>,</li>
<li><a href="http://www.ietf.org/rfc/rfc2616.txt" target="_blank">Specyfikacja protokołu HTTP/1.1</a>,</li>
<li><a href="https://github.com/SamouczekProgramisty/KursAplikacjeWebowe/tree/master/02_serwlety/src/main/java/pl/samouczekprogramisy/kursaplikacjewebowe/servlets" target="_blank">Kod źródłowy przykładów użytych w artykule</a>.</li><br />
</ul></p>
<h1>Podsumowanie</h1><br />
Po lekturze tego artykułu znasz już zestaw podstawowych klocków, z których buduje się aplikacje webowe. Wiesz już czym są parametry adresu URL i jak z nimi pracować. Znasz mechanizm nagłówków. Potrafisz powiedzieć czym jest ciasteczko i sesja. Po wykonaniu ćwiczenia znasz te zagadnienia także od praktycznej strony. Innymi słowy kawał wiedzy ;).</p>
<p>Na koniec mam do Ciebie prośbę. Zależy mi na dotarciu do jak największego grona Samouków takich jak Ty. Podziel się proszę linkiem do artykułu ze swoimi znajomymi. Mam nadzieję, że im także spodoba się artykuł.</p>
<p>Jeśli nie chcesz ominąć kolejnych artykułów dopisz się do samouczkowego newslettera i polub stronę na facebooku. Do następnego razu!</p>
<p>[FM_form id="3"]</p>
<p>Zdjęcie dzięki uprzejmości https://www.flickr.com/photos/nitot/6124595416/sizes/l</p>
