---
layout: post
status: publish
published: true
title: Kontekst serwletu i obiekty nasłuchujące w aplikacjach webowych
author:
  display_name: Marcin Pietraszek
  login: marcin
  email: m.pietraszek@gmail.com
  url: ''
author_login: marcin
author_email: m.pietraszek@gmail.com
excerpt: "W artykule przeczytasz o kolejnych podstawowych elementach, niezbędnych
  do budowania aplikacji webowych w Javie. Dowiedz się czym jest kontekst serwletu
  (ang. <em>servlet context<&#47;em>) i jak możesz go używać. Poznasz cykl życia aplikacji
  webowej i dowiesz się o zdarzeniach (ang. <em>events<&#47;em>), na które
  możesz reagować. Całość przećwiczysz rozwiązując zadanie znajdujące się na końcu
  artykułu.\r\n\r\n"
wordpress_id: 863
wordpress_url: http://www.samouczekprogramisty.pl/?p=863
date: '2017-04-21 16:04:41 +0200'
date_gmt: '2017-04-21 14:04:41 +0200'
categories:
- DSP2017
- Kurs aplikacji webowych
tags: []
comments: []
---
<p>W artykule przeczytasz o kolejnych podstawowych elementach, niezbędnych do budowania aplikacji webowych w Javie. Dowiedz się czym jest kontekst serwletu (ang. <em>servlet context<&#47;em>) i jak możesz go używać. Poznasz cykl życia aplikacji webowej i dowiesz się o zdarzeniach (ang. <em>events<&#47;em>), na które możesz reagować. Całość przećwiczysz rozwiązując zadanie znajdujące się na końcu artykułu.</p>
<p><a id="more"></a><a id="more-863"></a></p>
<h1><code>ServletContext<&#47;code><&#47;h1><br />
Obiekt implementujący <a href="https:&#47;&#47;docs.oracle.com&#47;javaee&#47;7&#47;api&#47;javax&#47;servlet&#47;ServletContext.html" target="_blank" rel="noopener noreferrer"><code>ServletContext<&#47;code><&#47;a> tworzony jest przez kontener serwletów. Istnieje tylko jeden taki obiekt dla każdej aplikacji webowej [0. Właściwie to, istnieje tylko jeden taki obiekt dla każdej wirtualnej maszyny Java. Jjeśli twoja aplikacja webowa jest rozproszona wówczas obiekt&oacute;w implementujących ten interfejs jest tyle, ile instancji JVM.]. Służy on gł&oacute;wnie do wsp&oacute;łdzielenia informacji w ramach aplikacji internetowej.</p>
<p>Czytając poprzednie artykuły z serii:</p>
<ul>
<li><a href="http:&#47;&#47;www.samouczekprogramisty.pl&#47;serwlety-w-aplikacjach-webowych&#47;">serwlety w aplikacjach webowych<&#47;a>,<&#47;li>
<li><a href="http:&#47;&#47;www.samouczekprogramisty.pl&#47;naglowki-sesje-i-ciasteczka&#47;">nagłówki, sesje i ciasteczka w aplikacjach webowych<&#47;a>,<&#47;li>
<li><a href="http:&#47;&#47;www.samouczekprogramisty.pl&#47;filtry-w-aplikacjach-webowych&#47;">filtry w aplikacjach webowych<&#47;a>,<&#47;li><br />
<&#47;ul><br />
poznałeś inne konteksty&#47;zakresy. Na przykład kontekst zapytania i kontekst sesji HTTP. W każdym z tych kontekstów mogłeś ustawić zestaw atrybutów. Atrybuty te &ldquo;żyły&rdquo; tak długo, jak aktywny był dany kontekst.</p>
<p>Podobnie jest tutaj. Z tym, że kontekst serwletu jest tylko jeden i aktywny jest przez cały czas &ldquo;życia&rdquo; aplikacji webowej. Podobnie jak w poprzednich przypadkach możesz w nim ustawiać atrybuty.</p>
<h2>Atrybuty kontekstu<&#47;h2><br />
Podobnie jak <code>Servlet<&#47;code> czy <code>HttpRequest<&#47;code> mają atrybuty, tak samo jest z <code>ServletContext<&#47;code>. Możesz ustawiać dowolne atrybuty w kontekście. Dzięki temu, że istnieje jeden kontekst dla całej aplikacji możesz w ten sposób przekazywać informacje pomiędzy serwletami.</p>
<p>Do pracy z atrybutami przechowywanymi w obiekcie implementującym <code>ServletContext<&#47;code> służą metody:</p>
<ul>
<li><a href="https:&#47;&#47;docs.oracle.com&#47;javaee&#47;7&#47;api&#47;javax&#47;servlet&#47;ServletContext.html#setAttribute-java.lang.String-java.lang.Object-" target="_blank" rel="noopener noreferrer"><code>setAttribute<&#47;code><&#47;a>,<&#47;li>
<li><a href="https:&#47;&#47;docs.oracle.com&#47;javaee&#47;7&#47;api&#47;javax&#47;servlet&#47;ServletContext.html#getAttribute-java.lang.String-" target="_blank" rel="noopener noreferrer"><code>getAttribute<&#47;code><&#47;a>,<&#47;li>
<li><a href="https:&#47;&#47;docs.oracle.com&#47;javaee&#47;7&#47;api&#47;javax&#47;servlet&#47;ServletContext.html#getAttributeNames--" target="_blank" rel="noopener noreferrer"><code>getAttributeNames<&#47;code><&#47;a>,<&#47;li>
<li><a href="https:&#47;&#47;docs.oracle.com&#47;javaee&#47;7&#47;api&#47;javax&#47;servlet&#47;ServletContext.html#removeAttribute-java.lang.String-" target="_blank" rel="noopener noreferrer"><code>removeAttribute<&#47;code><&#47;a>.<&#47;li><br />
<&#47;ul><br />
Instancję implementującą ten interfejs możemy uzyskać wywołując metodę <a href="https:&#47;&#47;docs.oracle.com&#47;javaee&#47;7&#47;api&#47;javax&#47;servlet&#47;ServletRequest.html#getServletContext--" target="_blank" rel="noopener noreferrer"><code>getServletContext<&#47;code><&#47;a> znajdującą się w interfejsie <a href="https:&#47;&#47;docs.oracle.com&#47;javaee&#47;7&#47;api&#47;javax&#47;servlet&#47;ServletRequest.html" target="_blank" rel="noopener noreferrer"><code>ServletRequest<&#47;code><&#47;a>.</p>
<p>Dzięki dostępowi do kontekstu serwletów możesz przekazywać atrybuty pomiędzy poszczególnymi serwletami. Przykładowy serwlet poniżej wyświetla wszystkie atrybuty kontekstu ustawiając wcześniej wartość jednego z nich.</p>
<pre class="lang:default decode:true ">@WebServlet("&#47;servlet1")<br />
public class Servlet1 extends HttpServlet {</p>
<p>    @Override<br />
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {<br />
        PrintWriter writer = resp.getWriter();<br />
        writer.write("<html><body>");</p>
<p>        ServletContext context = req.getServletContext();<br />
        context.setAttribute("pl.samouczekprogramisty.servlet1", "servlet1 attribute");</p>
<p>        Enumeration<String> attributeNames = context.getAttributeNames();<br />
        while (attributeNames.hasMoreElements()) {<br />
            String attributeName = attributeNames.nextElement();<br />
            writer.write("
<p>" + attributeName + ": " + context.getAttribute(attributeName) + "
<p>");<br />
        }<br />
        writer.write("<&#47;body><&#47;html>");<br />
    }<br />
}<&#47;pre><br />
Spróbuj uruchomić aplikację, która ma taki serwlet. Wpisując adres serwletu w przeglądarce zobaczysz wszystkie atrybuty kontekstu. Poza atrybutem ustawionym przez serwlet zobaczysz także inne, część z nich jest ustawiona przez sam kontener serwlet&oacute;w.</p>
<p>Dokumentacja zaleca aby nazwy atrybutów były zapisane w podobnej konwencji jak pakiety. Innymi słowy nazwy powinny wyglądać jak &ldquo;odwrócone adresy www&rdquo;, na przykład <code>pl.samouczekprogramisty.servelet1<&#47;code>.</p>
<h2>Dynamiczna konfiguracja<&#47;h2><br />
Ponadto twórcy bibliotek dzięki dostępowi do obiektu <code>ServletContext<&#47;code> mogą dynamicznie tworzyć serwlety, filtry czy obiekty nasłuchujące zdarzenia (ang. <em>listener<&#47;em>). Funkcjonalność ta raczej nie jest wykorzystywana w innych przypadkach.</p>
<h1>Obiekty nasłuchujące<&#47;h1><br />
Szczerze mówiąc miałem tu problem z tłumaczeniem :). Chodzi tu o obiekty, które potocznie nazywamy "listenerami". Obiekty nasłuchujące nie są specyficzne dla aplikacji webowych. Koncept tego typu używany jest także w innych miejscach. Jest to jeden z szeroko znanych wzorc&oacute;w projektowych. Wzorzec ten nazywany jest obserwatorem (ang. <em>observer<&#47;em>).</p>
<p>Kontener serwletów ma informację o wystąpieniu pewnych zdarzeń. Ty jako programista możesz chcieć być informowany o tych zdarzeniach. Na przykład chcesz dostać informację kiedy obiekt <code>ServletContext<&#47;code> zostanie utworzony. Aby to zrobić tworzysz własną instancję obiektu nasłuchującego, który implementuje interfejs <a href="http:&#47;&#47;docs.oracle.com&#47;javaee&#47;7&#47;api&#47;javax&#47;servlet&#47;ServletContextListener.html" target="_blank" rel="noopener noreferrer"><code>ServletContextListener<&#47;code><&#47;a>. Dodatkowo tę implementację oznaczasz adnotacją <a href="https:&#47;&#47;docs.oracle.com&#47;javaee&#47;7&#47;api&#47;javax&#47;servlet&#47;annotation&#47;WebListener.html" target="_blank" rel="noopener noreferrer"><code>@WebListener<&#47;code><&#47;a>. Dzięki temu kontener serwlet&oacute;w wie o twojej klasie. Wie, że musi ją powiadomić o takim zdarzeniu.</p>
<p>Poniższy diagram pokazuje jak te komponenty układają się w całość:</p>
<p><a href="http:&#47;&#47;www.samouczekprogramisty.pl&#47;wp-content&#47;uploads&#47;2017&#47;04&#47;wzorzec_observer.jpeg"><img class="aligncenter size-medium wp-image-869" src="http:&#47;&#47;www.samouczekprogramisty.pl&#47;wp-content&#47;uploads&#47;2017&#47;04&#47;wzorzec_observer-300x188.jpeg" alt="Wzorzec observer" width="300" height="188" &#47;><&#47;a></p>
<p>Kontener przechowuje listę obiektów implementujących interfejs <code>ServletContextListener<&#47;code>. Jedną z implementacji może być klasa <code>MyOwnImplementation<&#47;code> pokazana na diagramie. Następnie w każdym momencie kiedy wystąpi zdarzenie, którym interesuje się nasza implementacja kontener uruchamia odpowiednie metody. Metody te są zdefiniowane w iterfejsie <code>ServletContextListener<&#47;code>.</p>
<p>Zdarzenia dotyczące kontekstu nie są jedynymi. W trakcie działania aplikacji webowej występuje wiele zdarzeń. Zdarzenia te związane są z cyklem życia poszczególnych elementów aplikacji. Na przykład możesz być poinformowany o tym, że została utworzona sesja HTTP, albo o tym, że jakieś zapytanie zostało wysłane do aplikacji.</p>
<p>Poniżej znajduje się lista kilka przykładowych interfejsów obiektów nasłuchujących:</p>
<ul>
<li><a href="http:&#47;&#47;docs.oracle.com&#47;javaee&#47;7&#47;api&#47;javax&#47;servlet&#47;ServletContextListener.html" target="_blank" rel="noopener noreferrer"><code>ServletContextListener<&#47;code><&#47;a>,<&#47;li>
<li><a href="https:&#47;&#47;docs.oracle.com&#47;javaee&#47;7&#47;api&#47;javax&#47;servlet&#47;ServletContextAttributeListener.html" target="_blank" rel="noopener noreferrer"><code>ServletContextAttributeListener<&#47;code><&#47;a>,<&#47;li>
<li><a href="https:&#47;&#47;docs.oracle.com&#47;javaee&#47;7&#47;api&#47;javax&#47;servlet&#47;ServletRequestListener.html" target="_blank" rel="noopener noreferrer"><code>ServletRequestListener<&#47;code><&#47;a>,<&#47;li>
<li><a href="https:&#47;&#47;docs.oracle.com&#47;javaee&#47;7&#47;api&#47;javax&#47;servlet&#47;ServletRequestAttributeListener.html" target="_blank" rel="noopener noreferrer"><code>ServletRequestAttributeListener<&#47;code><&#47;a>,<&#47;li>
<li><a href="https:&#47;&#47;docs.oracle.com&#47;javaee&#47;7&#47;api&#47;javax&#47;servlet&#47;http&#47;HttpSessionListener.html" target="_blank" rel="noopener noreferrer"><code>HttpSessionListener<&#47;code><&#47;a>,<&#47;li>
<li><a href="https:&#47;&#47;docs.oracle.com&#47;javaee&#47;7&#47;api&#47;javax&#47;servlet&#47;http&#47;HttpSessionAttributeListener.html" target="_blank" rel="noopener noreferrer"><code>HttpSessionAttributeListener<&#47;code><&#47;a>.<&#47;li><br />
<&#47;ul><br />
Na przykład, obiekt implementujący interfejs <code>ServletContextAttributeListener<&#47;code> zostanie poinformowany o wszystkich operacjach na atrybutach kontekstu serwletu.</p>
<p>Aby kontener serwletów wiedział o obiekcie nasłuchującym trzeba go odpowiednio skonfigurować. Każdy z obiektów nasłuchujących powinien być dekorowany wspomnianą adnotacją <code>@WebListener<&#47;code> [1. Może też być zdefiniowany w pliku <code>web.xml<&#47;code>, <code>web-fragment.xml<&#47;code> czy dodany dynamicznie przez metody dostępne w <code>ServletContext<&#47;code>, jednak te sposoby wykraczają poza zakres tego artykułu.].</p>
<p>Poniżej znajduje się przykładowa implementacja interfejsu <code>ServletContextListener<&#47;code>, która dodaje dodatkowy atrybut w momencie utworzenia kontekstu serwletu:</p>
<pre class="lang:default decode:true ">@WebListener<br />
public class MyServletContextListener implements ServletContextListener {</p>
<p>    @Override<br />
    public void contextInitialized(ServletContextEvent sce) {<br />
        sce.getServletContext().setAttribute("pl.samouczekprogramisty.listener", "listener value");<br />
    }</p>
<p>    @Override<br />
    public void contextDestroyed(ServletContextEvent sce) {<br />
        &#47;&#47; do nothing<br />
    }<br />
}<&#47;pre></p>
<h2>Praktyczne wykorzystanie<&#47;h2><br />
W poprzednich artykułach opisujących elementy specyfikacji serwletów odwoływałem się do Spring MVC. Nie inaczej będzie i tym razem. Przykładowym obiektem nasłuchującym zaimplementowanym w Spring MVC może być <a href="https:&#47;&#47;github.com&#47;spring-projects&#47;spring-framework&#47;blob&#47;v4.3.8.RELEASE&#47;spring-web&#47;src&#47;main&#47;java&#47;org&#47;springframework&#47;web&#47;util&#47;WebAppRootListener.java" target="_blank" rel="noopener noreferrer"><code>WebAppRootListener<&#47;code><&#47;a>. Obiekt ten reaguje na utworzenie&#47;zniszczenie kontekstu serwletów. Zachęcam Cię do przeszukania kodu źr&oacute;dłowego Spring MVC pod kątem innych obiekt&oacute;w, kt&oacute;re reagują na zdarzenia w aplikacji webowej.</p>
<p>Implementacja odpowiednich interfejsów, które pozwalają reagować na zdarzenia umożliwia konfigurację Spring MVC. W praktyce &ldquo;magiczny Spring&rdquo; nie robi nic innego jak wykorzystuje elementy specyfikacji serwlet&oacute;w.</p>
<h1>Ćwiczenie do wykonania<&#47;h1><br />
Napisz serwlet, który wyświetli wszystkie atrybuty kontekstu. Dodatkowo niech serwlet ten dodaje parametry przekazane w adresie URL jako atrybuty kontekstu. Na przykład żądanie na adres <code>...&#47;serwlet?pl.parametr=xxx<&#47;code> powinno utworzyć atrybut kontekstu o nazwie <code>pl.parametr<&#47;code> z wartością <code>xxx<&#47;code>.</p>
<p>Uzupełnij tę aplikację o implementację interfejsu <code>ServletContextAttributeListener<&#47;code>. Niech twój słuchacz w momencie dodawania nowego atrybuty kontekstu doda kolejny atrybut z datą jego dodania. Na przykład jeśli dodamy atrybut o nazwie <code>pl.parametr<&#47;code> to automatycznie powinien zostać dodany atrybut <code>pl.parametr.when<&#47;code>. Wartością nowego atrybutu powinna być data dodania atrybutu.</p>
<p>Pamiętaj żeby zabepieczyć się przed "nieskończoną pętlą" - twój obiekt zostanie także powiadomiony o dodaniu atrybutu <code>pl.parametr.when<&#47;code> i wtedy spróbuje dodać kolejny <code>pl.pamrater.when.when<&#47;code>, o kt&oacute;rym także byłby powiadomiony.</p>
<p>Jeśli będziesz miał problem z rozwiązaniem zadania możesz rzucić okiem na <a href="https:&#47;&#47;github.com&#47;SamouczekProgramisty&#47;KursAplikacjeWebowe&#47;tree&#47;master&#47;04_kontekst&#47;src&#47;main&#47;java&#47;pl&#47;samouczekprogramisty&#47;kursaplikacjewebowe&#47;exercise" target="_blank" rel="noopener noreferrer">przykładowe rozwiązanie<&#47;a>. Jak zwykle jednak zachęcam do samodzielego rozwiązania zadania. Wtedy nauczysz się najwięcej.</p>
<h1>Dodatkowe materiały do nauki<&#47;h1></p>
<ul>
<li><a href="http:&#47;&#47;download.oracle.com&#47;otndocs&#47;jcp&#47;servlet-3_1-fr-eval-spec&#47;index.html" target="_blank" rel="noopener noreferrer">Specyfikacja serwletów<&#47;a>,<&#47;li>
<li><a href="https:&#47;&#47;en.wikipedia.org&#47;wiki&#47;Observer_pattern" target="_blank" rel="noopener noreferrer">Artykuł na wikipedii nt. wzorca projektowego observer<&#47;a>,<&#47;li>
<li><a href="https:&#47;&#47;github.com&#47;SamouczekProgramisty&#47;KursAplikacjeWebowe&#47;tree&#47;master&#47;04_kontekst&#47;src&#47;main&#47;java&#47;pl&#47;samouczekprogramisty&#47;kursaplikacjewebowe" target="_blank" rel="noopener noreferrer">Kod źródłowy przykładów użytych w artykule<&#47;a>.<&#47;li><br />
<&#47;ul></p>
<h1>Podsumowanie<&#47;h1><br />
Wiesz już czym jest <code>ServletContext<&#47;code> i do czego może być używany. Poznałeś przykłady obiektów nasłuchujących zdarzeń w aplikacjach webowych. Znasz przykłady praktycznego ich wykorzystania. Po wykonaniu ćwiczenia potrafisz zastosować tę wiedzę w praktyce. Innymi słowy poznałeś mechanizmy, pozwalające na działanie aplikacji webowych :).</p>
<p>Mam nadzieję, ze artykuł Ci się podobał. Jeśli nie chcesz pominąć kolejnych zapisz się do samouczkowego newslettera i polub stronę na facebooku.</p>
<p>Na koniec mam do Ciebie prośbę. Zależy mi na dotarciu do jak największego grona czytelników. Możesz mi w tym pomóc przekazując link do artykułu swoim znajomym. Z g&oacute;ry dziękuję i do następnego razu!</p>
<p>[FM_form id="3"]</p>
<p>Zdjęcie dzięki uprzejmości https:&#47;&#47;www.flickr.com&#47;photos&#47;fkhuckel&#47;33244430220&#47;sizes&#47;l</p>
