---
layout: post
status: publish
published: true
title: Deskryptor wdrożenia w aplikacjach webowych
author:
  display_name: Marcin Pietraszek
  login: marcin
  email: m.pietraszek@gmail.com
  url: ''
author_login: marcin
author_email: m.pietraszek@gmail.com
excerpt: "Do tej pory w konfigurowaniu wszystkich elementów aplikacji webowej
  posługiwałem się adnotacjami. Nadszedł czas abyś poznał inny sposób konfiguracji
  aplikacji webowych. Konfiguracja przy pomocy pliku <code>web.xml</code> nazywanego
  deskryptorem wdrożenia.\r\n\r\n"
wordpress_id: 876
wordpress_url: http://www.samouczekprogramisty.pl/?p=876
date: '2017-04-27 21:56:57 +0200'
date_gmt: '2017-04-27 19:56:57 +0200'
categories:
- DSP2017
- Kurs aplikacji webowych
tags: []
comments: []
---
<p>Do tej pory w konfigurowaniu wszystkich elementów aplikacji webowej posługiwałem się adnotacjami. Nadszedł czas abyś poznał inny sposób konfiguracji aplikacji webowych. Konfiguracja przy pomocy pliku <code>web.xml</code> nazywanego deskryptorem wdrożenia.</p>
<p><a id="more"></a><a id="more-876"></a></p>
<h1>Deskryptor wdrożenia</h1><br />
Plik <code>web.xml</code> nazywany jest deskryptorem wdrożenia. W starszych wersjach specyfikacji serwletów tylko przy jego pomocy można było konfigurować aplikacje webowe.</p>
<p>Aktualnie plik <code>web.xml</code> nie jest wymagany, praktycznie wszystkie elementy można skonfigurować przy pomocy adnotacji. Jednak nadal zdarzają się aplikacje gdzie taki plik jest wykorzystywany. W związku z tym dobrze jest wiedzieć o jego istnieniu.</p>
<p>Oczywiście zawartością deskryptora wdrożenia są znaczniki XML, jeśli nie miałeś wcześniej styczności z tym formatem zapraszam do osobnego artykułu ze <a href="http://www.samouczekprogramisty.pl/xml-dla-poczatkujacych/">wstępem do formatu XML</a>.</p>
<p>Plik <code>web.xml</code> powinien znajdować się bezpośrednio w katalogu WEB-INF wewnątrz pliku war. Struktura przykładowego pliku war może wyglądać następująco:</p>
<pre class="lang:default highlight:0 decode:true ">$ unzip -l build/libs/05_webxml-1.0-SNAPSHOT.war<br />
Archive:  build/libs/05_webxml-1.0-SNAPSHOT.war<br />
  Length      Date    Time    Name<br />
---------  ---------- -----   ----<br />
        0  2017-04-27 20:15   META-INF/<br />
       25  2017-04-27 20:12   META-INF/MANIFEST.MF<br />
        0  2017-04-27 20:15   WEB-INF/<br />
        0  2017-04-27 20:15   WEB-INF/classes/<br />
        0  2017-04-26 21:36   WEB-INF/classes/pl/<br />
        0  2017-04-26 21:36   WEB-INF/classes/pl/samouczekprogramisty/<br />
        0  2017-04-26 21:36   WEB-INF/classes/pl/samouczekprogramisty/kursaplikacjewebowe/<br />
        0  2017-04-27 20:15   WEB-INF/classes/pl/samouczekprogramisty/kursaplikacjewebowe/webxml/<br />
        0  2017-04-27 20:15   WEB-INF/classes/pl/samouczekprogramisty/kursaplikacjewebowe/webxml/xml/<br />
     1073  2017-04-27 20:15   WEB-INF/classes/pl/samouczekprogramisty/kursaplikacjewebowe/webxml/xml/XMLConfiguredListener.class<br />
     3045  2017-04-27 20:15   WEB-INF/classes/pl/samouczekprogramisty/kursaplikacjewebowe/webxml/xml/XMLConfiguredServlet.class<br />
     1330  2017-04-27 20:15   WEB-INF/classes/pl/samouczekprogramisty/kursaplikacjewebowe/webxml/xml/XMLConfiguredFilter.class<br />
     1227  2017-04-26 21:40   WEB-INF/web.xml<br />
---------                     -------<br />
     6700                     13 files<br />
</pre><br />
Strukturę aplikacji webowej opisywałem szczegółowo w pierwszym <a href="http://www.samouczekprogramisty.pl/serwlety-w-aplikacjach-webowych/">artykule wprowadzającym</a>.</p>
<h1>Szablon <code>web.xml</code></h1><br />
Plik <code>web.xml</code> informuje kontener serwletów o wersji specyfikacji serwletów. Dla każdej wersji specyfikacji plik ten różni się nagłówkiem. Dla wersji 3.1 szablon pliku wygląda następująco</p>
<pre class="lang:default highlight:0 decode:true "><web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"<br />
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br />
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee<br />
         http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"<br />
         version="3.1"><br />
    <!-- tutaj są znaczniki do konfiguracji --><br />
</web-app></pre><br />
Jak widzisz w głównym węzłem deskryptora wdrożenia jest <code><web-app></code>. Wewnątrz tego znacznika znajduje się właściwe elementy konfigurujące aplikację webową.</p>
<p>W kolejnej części artykułu zobaczysz porównanie konfiguracji przy pomocy znaczników XML z konfiguracją zapisaną w postaci adnotacji. W obu przypadkach pokazywał będę prostą aplikację, która zawiera serwlet, obiekt nasłuchujący i filtr. Przykładowy deskryptor wdrożenia możesz zobaczyć na <a href="https://github.com/SamouczekProgramisty/KursAplikacjeWebowe/blob/master/05_webxml/src/main/webapp/WEB-INF/web.xml" target="_blank" rel="noopener noreferrer">samouczkowym githubie</a>. Zawiera on wszystkie elementy omówione poniżej.</p>
<h2>Konfiguracja serwletu</h2><br />
Podstawowa konfiguracja serwletu sprowadza się do nadania mu nazwy i podpięcia go pod odpowiedni adres URL. Zobacz jak taki efekt można osiągnąć przy pomocy znaczników XML i adnotacji.</p>
<h3>Znaczniki XML</h3></p>
<pre class="lang:default highlight:0 decode:true"><servlet><br />
    <servlet-name>my-servlet</servlet-name><br />
    <servlet-class>pl.samouczekprogramisty.kursaplikacjewebowe.webxml.xml.XMLConfiguredServlet</servlet-class><br />
</servlet></p>
<p><servlet-mapping><br />
    <servlet-name>my-servlet</servlet-name><br />
    <url-pattern>/servlet-url-xml</url-pattern><br />
</servlet-mapping></pre><br />
Powyższy fragment xml zawiera kilka znaczników. Pierwszy z nich <code><servlet></code> informuje kontener serwletów o tym, ze w klasie <code>pl.samouczekprogramisty.kursaplikacjewebowe.webxml.xml.XMLConfiguredServlet</code> znajduje się serwlet. Nadałem mu nazwę <code>my-servlet</code>. Następnie wewnątrz <code><servlet-mapping></code>, posługując się wcześniej nadaną nazwą podpinam serwlet pod adres URL <code>/servlet-url-xml</code>.</p>
<h3>Adnotacje</h3></p>
<pre class="lang:default decode:true">@WebServlet(name = "my-servlet", urlPatterns = "/servlet-url-annotations")<br />
public class AnnotationConfiguredServlet extends HttpServlet</pre><br />
W przypadku adnotacji sprawa jest prostsza. Tutaj nie muszę podawać dokładnej nazwy klasy wraz z pakietem. Adnotacja znajduje się właśnie w nad tą klasą.</p>
<h2>Konfiguracja filtra</h2><br />
Aby skonfigurować podstawowy filtr należy nadać mu nazwę i podpiąć go pod serwlet czy adres URL. Poniżej możesz porównać oba sposoby konfiguracji.</p>
<h3>Znaczniki XML</h3></p>
<pre class="lang:default highlight:0 decode:true "><filter><br />
    <filter-name>my-filter</filter-name><br />
    <filter-class>pl.samouczekprogramisty.kursaplikacjewebowe.webxml.xml.XMLConfiguredFilter</filter-class><br />
</filter></p>
<p><filter-mapping><br />
    <filter-name>my-filter</filter-name><br />
    <url-pattern>/servlet-url-xml</url-pattern><br />
</filter-mapping></p>
<p><filter-mapping><br />
    <filter-name>my-filter</filter-name><br />
    <servlet-name>my-servlet</servlet-name><br />
</filter-mapping></pre><br />
Podobnie jak w przypadku serwletu pierwszy znacznik <code><filter></code> tworzy filtr o nazwie <code>my-filter</code> podpinając klasę <code>pl.samouczekprogramisty.kursaplikacjewebowe.webxml.xml.XMLConfiguredFilte</code>. Kolejne dwie grupy znaczników <code><filter-mapping></code> posługują się nazwą filtra. Pierwsza używa <code><url-pattern></code> aby podpiąć filtr pod konkretny adres URL. Wewnątrz drugiego znacznika <code><filter-mapping></code> użyłem <code><servlet-name></code> aby podpiąć filtr pod konkretny serwlet.</p>
<h3>Adnotacje</h3></p>
<pre class="lang:default decode:true ">@WebFilter(filterName = "my-filter", servletNames = "my-servlet", urlPatterns = "/servlet-url-annotations")<br />
public class AnnotationConfiguredFilter implements Filter</pre></p>
<h2>Konfiguracja obiektu nasłuchującego</h2><br />
W tym przypadku sprawa jest prosta. Cała konfiguracja sprowadza się do poinformowania kontenera serwletów o istnieniu takiego obiektu.</p>
<h3>Znacznik XML</h3></p>
<pre class="lang:default highlight:0 decode:true ">
<listener>
<listener-class>pl.samouczekprogramisty.kursaplikacjewebowe.webxml.xml.XMLConfiguredListener</listener-class><br />
</listener></pre></p>
<h3>Adnotacje</h3></p>
<pre class="lang:default decode:true ">@WebListener<br />
public class AnnotationConfiguredListener implements ServletRequestListener</pre></p>
<h1>Dodatkowe informacje</h1></p>
<h2>Kiedy plik web.xml jest niezbędny</h2><br />
Są sytuacje w których plik web.xml jest niezbędny. W przypadku kiedy istotna jest kolejność wykonania filtrów, obiektów nasłuchujących czy przypisania serwletów do adresów URL plik web.xml jest niezbędny. Specyfikacja serwletów jasno mówi o tym, że bez tego pliku kolejność wywołania tych elementów nie jest jasno określona.</p>
<h2>Modułowość konfiguracji</h2><br />
Konfigurację podobną do tej z pliku <code>web.xml</code> można zawrzeć w plikach <code>web-fragment.xml</code>. Taki plik może znajdować się w każdym pliku jar, który znajduje się wewnątrz pliku war (ponownie odsyłam do <a href="http://www.samouczekprogramisty.pl/serwlety-w-aplikacjach-webowych/">artykułu opisującego strukturę aplikacji webowej</a>). Konkretnie w katalogu <code>META-INF</code> wewnątrz pliku jar.</p>
<p>Wewnątrz pliku <code>web-fragment.xml</code> możemy użyć tych samych znaczników jak pliku <code>web.xml</code>. Różnicą jest tutaj znacznik główny. W tym przypadku jest to <code><web-fragment></code> a nie <code><web-app></code>.</p>
<h2>Ostatnie słowo ma <code>web.xml</code></h2><br />
Chociaż dla niektórych osób adnotacje czy pliki <code>web-fragment.xml</code> mogą być preferowanym wyborem to <code>web.xml</code> ma ostatnie słowo. Mam tu na myśli atrybut <code>metadat-complete</code>. Atrybut ten można ustawić na znaczniku <code><web-app></code>. Jeśli przyjmie on wartość <code>true</code>, wówczas adnotacje i pliki <code>web-fragment.xml</code> będą ignorowane. W takim przypadku cała konfiguracja aplikacji webowej musi znajdować się w pliku <code>web.xml</code>.</p>
<pre class="lang:default highlight:0 decode:true "><web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"<br />
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br />
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee<br />
         http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"<br />
         version="3.1"<br />
         metadata-complete=&rdquo;true&rdquo;></p>
<p>    <!-- tutaj są znaczniki do konfiguracji --></p>
<p></web-app></pre></p>
<h1>Przykładowe aplikacje</h1><br />
Na potrzeby tego artykułu napisałem dwie proste aplikacje. Jedna z nich skonfigurowana jest wyłączni przy użyciu znaczników xml, druga tylko adnotacji. Zachęcam do zajrzenia do kodu, który umieściłem na githubie:</p>
<ul>
<li><a href="https://github.com/SamouczekProgramisty/KursAplikacjeWebowe/tree/master/05_webxml/src/main" target="_blank" rel="noopener noreferrer">Aplikacja konfigurowana wyłącznie przy pomocy XML</a>,</li>
<li><a href="https://github.com/SamouczekProgramisty/KursAplikacjeWebowe/tree/master/05_webxml_annotations/src/main/" target="_blank" rel="noopener noreferrer">Aplikacja konfigurowana wyłącznie przy pomocy adnotacji</a>.</li><br />
</ul></p>
<h1>Podsumowanie</h1><br />
Przedstawiłem tutaj wyłącznie podstawowe znaczniki stosowane wewnątrz pliku <code>web.xml</code>. Zależało mi na tym abyś sam mógł zobaczyć różnicę pomiędzy tymi podejściami. Nie oceniam, które z nich jest lepsze, które gorsze. Każde z nich ma swoje wady i zalety. Wybierz ten sposób, który bardziej Ci odpowiada i konsekwentnie się go trzymaj.</p>
<p>Z jednej strony posiadanie całej konfiguracji w pliku xml jest wygodne. Jednak z drugiej strony w przypadku adnotacji edytując kod od razu masz informacje o konfiguracji. Ciekawy jestem Twojego zdania. Które podejście bardziej Ci odpowiada i dlaczego?</p>
<p>[FM_form id="3"]</p>
<p>Zdjęcie dzięki uprzejmości https://www.flickr.com/photos/photos_by_clark/26137047996/sizes/l</p>
